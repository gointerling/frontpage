import{_ as ne}from"./DvumrKrj.js";import{_ as ie}from"./DGrq4f1g.js";import{_ as Q}from"./G_bPuirm.js";import{_ as W}from"./CDkhUFr5.js";import{x as re,L as ce,g as Y,r as c,B as ue,D as de,h as E,o as r,l as C,w as n,b as a,a as s,c as h,q as F,d as S,m as me,t as m,n as K,k as G,F as pe,a0 as _e,s as X,v as Z,i as fe,j as ge}from"./BTSDszUJ.js";import{_ as ee}from"./CGyI2hQu.js";import{_ as ve,a as xe}from"./BvyGCBkE.js";import{_ as ye}from"./veiQDZO_.js";import{_ as he}from"./B9XNv89N.js";import{_ as be}from"./n_hcIHAQ.js";import{_ as ke}from"./DueKQsIK.js";import{_ as we}from"./BYiaUImn.js";import{u as te}from"./ONxWT7kH.js";import"./ZcxYWiyP.js";import"./QMTWwr3q.js";import"./BzSNmRo5.js";import"./P5m1VOJr.js";import"./7ZUwepPQ.js";import"./DRO6Gor9.js";const Ce={class:"flex justify-between items-center w-full border-b border-1 pb-4"},$e=s("h3",{class:"text-lg font-semibold w-full flex justify-center text-primary"}," Discussions ",-1),Oe={class:"flex flex-col items-center justify-between w-full h-full"},Ue={key:0,class:"py-4 text-gray-400"},Se={id:"comment-section",class:"w-full h-full max-h-[550px] overflow-auto px-2 py-1"},Ve={key:0,class:"pb-4"},je={class:"flex gap-2 items-center"},Ie={class:"flex flex-col items-start gap-1"},De=s("span",{class:"font-semibold text-primary"}," You ",-1),Me=s("span",{class:"capitalize"}," Faciliator ",-1),Fe={class:"flex text-gray-700 my-3 text-sm"},Pe={class:"text-gray-700 text-sm"},ze={key:1,class:"pb-4"},Te={class:"flex gap-2 items-center"},Ae={class:"flex flex-col items-start gap-1"},Be={class:"font-semibold"},Ne={class:"flex text-gray-700 my-3 text-sm"},Le={class:"text-gray-700 text-sm"},Re={class:"flex justify-end border-t border-1 pt-2 gap-2"},qe={__name:"CommentSidebar",props:{isOpen:{type:Boolean,default:!1},data:{type:Object,default:()=>({id:0,price:0,comments:{data:[],total:0},callback:()=>{}})}},emits:["update:isOpen","hide","refresh"],setup(J,{emit:N}){const{updateMyOrder:P}=te();re(),ce();const V=Y(),u=J,j=N,$=c(3),v=ue("token").value.user,_=c({user:{fullname:v.fullname,photo:v.photo},message:"",time:new Date().toISOString(),file_url:"",other_link:"",is_facilitator:!0}),I=de(()=>u.data.comments.data.slice(0,$.value)),f=c(u.isOpen);E(()=>u.isOpen,i=>{f.value=i,i||D()}),E(f,i=>{j("update:isOpen",i)});const D=()=>{f.value=!1,j("hide")},O=i=>{const d=new Date,x=new Date(i),g=Math.floor((d-x)/1e3),p={year:31536e3,month:2592e3,week:604800,day:86400,hour:3600,minute:60,second:1};for(const y in p){const b=Math.floor(g/p[y]);if(b>=1)return b===1?`${b} ${y} ago`:`${b} ${y}s ago`}return"just now"},z=i=>{_.value.file_url=i},T=i=>{window.open(i,"_blank")},L=i=>{u.data.comments.data=i,j("refresh",u.data)},R=async i=>{const d=u.data.actions.id,x=u.data.comments.data??[];if(!i.message&&i.file_url&&(i.message="Here I attached a file."),!i.message&&!i.file_url){V.add({title:"Failed!",color:"red",icon:"i-heroicons-x-circle",description:"Comment message is required!"});return}x.push(i);try{const{data:g}=await P(d,{comment_json:x});V.add({title:"Success!",color:"green",icon:"i-heroicons-check-circle",description:"Order updated successfully!"}),L(x),$.value=x.length,setTimeout(()=>{const p=document.getElementById("comment-section");p.scrollTop=p.scrollHeight},2),_.value={user:{fullname:v.fullname,photo:v.photo},message:"",time:new Date().toISOString(),file_url:"",other_link:"",is_facilitator:!0}}catch(g){console.error("Updating order failed:",g),V.add({title:"Failed!",color:"red",icon:"i-heroicons-x-circle",description:"Failed to update order!"})}};return(i,d)=>{const x=ee,g=_e,p=X,y=Z,b=W,U=Q,l=be,t=ke,k=we;return r(),C(k,{modelValue:f.value,"onUpdate:modelValue":d[3]||(d[3]=o=>f.value=o),fullscreen:"","prevent-close":"",ui:{base:"!w-[600px] absolute top-0 right-0 h-screen bg-white dark:bg-gray-800 rounded-l-3xl",rounded:"rounded-l-3xl rounded-r-0"}},{default:n(()=>[a(U,{ui:{base:"h-full ",ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800",rounded:"rounded-l-3xl rounded-r-0",body:{base:"flex flex-col justify-between h-full",padding:"px-6 py-5 sm:p-10"},header:{padding:"px-6 py-5 sm:px-8"},footer:{padding:"px-6 py-4 sm:px-10"}}},{default:n(()=>[s("div",Ce,[s("button",{onClick:D},[a(x,{name:"back",class:"text-2xl text-primary dark:text-gray-300"})]),$e]),s("div",Oe,[u.data.comments.total===0?(r(),h("div",Ue," Start Discussion ")):F("",!0),$.value<u.data.comments.total?(r(),C(p,{key:1,block:"",color:"primary",variant:"soft",class:"my-4 bg-blue-100 hover:bg-blue-200",onClick:d[0]||(d[0]=o=>$.value=u.data.comments.total)},{default:n(()=>[a(g,{name:"i-heroicons-chat-bubble-oval-left-ellipsis"}),S(" Load Previous Comments ")]),_:1})):F("",!0),s("div",Se,[(r(!0),h(pe,null,me(G(I),o=>(r(),h("div",{key:o,class:"w-full"},[o.is_facilitator?(r(),h("div",Ve,[a(U,{ui:{body:{base:"w-full",padding:"p-4 sm:p-4"}},class:"flex gap-4 items-center w-ful bg-gray-100"},{default:n(()=>[s("div",je,[a(y,{alt:o.user.fullname,src:o.user.photo,size:"md",imgClass:"object-cover"},null,8,["alt","src"]),s("div",Ie,[De,a(b,{variant:"soft",size:"xs",color:"blue"},{default:n(()=>[Me]),_:1})])]),s("div",Fe,m(o.message),1),s("div",{class:K(["flex items-center",o.file_url?"justify-between":"justify-end"])},[o.file_url?(r(),C(p,{key:0,color:"green",variant:"soft",onClick:w=>T(o.file_url)},{default:n(()=>[a(g,{name:"i-heroicons-arrow-down-tray"}),S(" Attached File ")]),_:2},1032,["onClick"])):F("",!0),s("span",Pe,m(O(new Date(o.time),{addSuffix:!0})),1)],2)]),_:2},1024)])):(r(),h("div",ze,[a(U,{ui:{body:{base:"w-full",padding:"p-4 sm:p-4"}},class:"flex gap-4 items-center w-full"},{default:n(()=>[s("div",Te,[a(y,{alt:o.user.fullname,src:o.user.photo,size:"md",imgClass:"object-cover"},null,8,["alt","src"]),s("div",Ae,[s("span",Be,m(o.user.fullname),1)])]),s("div",Ne,m(o.message),1),s("div",{class:K(["flex items-center",o.file_url?"justify-between":"justify-end"])},[o.file_url?(r(),C(p,{key:0,color:"green",variant:"soft",onClick:w=>T(o.file_url)},{default:n(()=>[a(g,{name:"i-heroicons-arrow-down-tray"}),S(" Attached File ")]),_:2},1032,["onClick"])):F("",!0),s("span",Le,m(O(new Date(o.time))),1)],2)]),_:2},1024)]))]))),128))])]),a(U,{ui:{body:{base:"w-full",padding:"p-4 sm:p-2"}},class:"flex gap-4 items-center w-full"},{default:n(()=>[a(l,{modelValue:_.value.message,"onUpdate:modelValue":d[1]||(d[1]=o=>_.value.message=o),class:"w-full mb-2",placeholder:"Add Comment...",variant:"none"},null,8,["modelValue"]),s("div",Re,[a(t,{"is-display-file":!1,accept:"*","max-size":"6291456",onFileUploaded:z}),a(p,{color:"primary",onClick:d[2]||(d[2]=o=>R(_.value))},{default:n(()=>[a(g,{name:"i-heroicons-paper-airplane"}),S(" Send ")]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},He={class:"pt-0 p-6 flex flex-col gap-2"},Ee={class:"flex gap-2"},Je={key:0,class:"flex flex-col gap-1 items-start capitalize"},Ke={class:"text-primary"},Qe={key:1,class:"text-gray-300"},We={class:"text-primary"},Ye={class:"text-primary"},Ge={class:"flex gap-3 items-center"},Xe={class:"flex flex-col"},Ze={class:"font-semibold text-primary"},et={class:"text-sm text-gray-600"},tt={key:1,class:"text-gray-300"},at={class:"flex gap-1"},ot="Order List",wt={__name:"orders",setup(J){const{getMyMerchantOrders:N}=te();Y();const P=c(!0),V=c(!1),u=c(!1);c(!1);const j=c({title:"",message:"",callback:null});c([]);const $=c([]),v=c({label:"All",value:"all"}),_=c(null),I=c(""),f=c(1),D=c({page:1,totalPage:1,totalItems:0,itemsPerPage:10}),O=async()=>{try{await N({page:f.value,per_page:D.value.itemsPerPage,status:v.value.value==="all"?"":v.value.value,search:I.value}).then(l=>{$.value=l.data.data.orders.data.map((t,k)=>({no:k+1,service:{id:t.service.id,name:t.merchant.type,type:t.service.type},buyer:{id:t.user.id,fullname:t.user.fullname,email:t.user.email},"order date":d(t.created_at,"dd MMM yyyy"),estimated:`${t.service.time_estimated} ${t.service.time_estimated_unit}`,languages:{language_source:t.language_source,language_destination:t.language_destination},price:t.price,comments:{total:x(t.comment_json)?t.comment_json.length:0,data:t.comment_json||[]},status:t.order_status,file:t.user_file_url,actions:{id:t.id,status:t.order_status}}))})}catch(l){console.error("Error fetching merchant orders:",l)}finally{P.value=!1}};E(f,O);const z=()=>{O(f.value,v.value.value,I.value)},T=L(()=>{z()},500);function L(l,t,k){let o;return function(){const w=this,A=arguments,q=function(){o=null,l.apply(w,A)};clearTimeout(o),o=setTimeout(q,t)}}const R=l=>{window.open(l,"_blank")},i=l=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(l),d=l=>new Date(l).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}),x=l=>{try{return JSON.parse(l)}catch{return l}},g=l=>{_.value=l,console.log("Refreshed data:",_)},p=()=>{u.value=!1,O()},y=(l,t,k,o,w)=>{j.value={title:l,content:t,confirmText:k,cancelText:o,callback:w},V.value=!0},b=l=>{_.value=l,console.log("selectedOrder",_.value),u.value=!0},U=l=>{switch(l){case"completed":return{color:"green",text:"Completed"};case"paid":return{color:"blue",text:"In Progress"};case"pending":return{color:"violet",text:"Pending"};case"waitingpaid":return{color:"orange",text:"Approved"};case"failed":return{color:"red",text:"Failed"};default:return{color:"gray",text:"Unknown"}}};return fe(()=>{O()}),(l,t)=>{const k=ne,o=ie,w=Q,A=W,q=Z,M=X,ae=ee,H=ve,oe=ye,se=xe,le=ge;return r(),h("div",null,[a(le,{name:"merchant"},{default:n(()=>[s("div",He,[a(w,{ui:{body:{base:"flex justify-between items-center w-full",background:"",padding:"p-2 sm:p-4"}}},{default:n(()=>[s("h6",{class:"font-semibold"},m(ot)),s("div",Ee,[a(k,{options:[{label:"All",value:"all",color:"gray"},{label:"Completed",value:"completed",color:"orange"},{label:"In Progress",value:"paid",color:"blue"},{label:"Pending",value:"pending",color:"orange"},{label:"In Progress",value:"waitingpaid",color:"orange"},{label:"Failed",value:"failed",color:"orange"}],modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e),placeholder:"Pilih Status",by:"value","option-attribute":"label","search-attributes":["label"],onChange:z,class:"max-w-[180px]"},null,8,["modelValue"]),a(o,{icon:"i-heroicons-magnifying-glass-20-solid",size:"sm",color:"white",trailing:!1,placeholder:"Search Order",modelValue:I.value,"onUpdate:modelValue":t[1]||(t[1]=e=>I.value=e),onInput:t[2]||(t[2]=e=>G(T)())},null,8,["modelValue"])])]),_:1}),a(w,{ui:{body:{base:"flex flex-col gap-4"}}},{default:n(()=>[a(oe,{rows:$.value,loading:P.value,"loading-state":{icon:"i-heroicons-arrow-path-20-solid",label:"Loading..."},ui:{wrapper:"max-w-full relative overflow-x-auto",base:" table-fixed overflow-x-auto"}},{"service-data":n(({row:e})=>[e.service?(r(),h("div",Je,[s("span",Ke,m(e.service.name)+" Service ",1),a(A,{variant:"soft",color:"orange",class:"capitalize"},{default:n(()=>[S(m(e.service.type),1)]),_:2},1024)])):(r(),h("span",Qe," Kosong "))]),"price-data":n(({row:e})=>[s("span",We,m(i(e.price)),1)]),"languages-data":n(({row:e})=>[s("span",Ye,m(e.languages.language_source.name)+" -> "+m(e.languages.language_destination.name),1)]),"buyer-data":n(({row:e})=>[s("div",Ge,[a(q,{src:e.buyer.photo,alt:e.buyer.fullname,size:"sm",variant:"rounded-full",imgClass:"object-cover"},null,8,["src","alt"]),s("div",Xe,[s("span",Ze,m(e.buyer.fullname),1),s("span",et,m(e.buyer.email),1)])])]),"comments-data":n(({row:e})=>[a(M,{size:"sm",color:"blue",variant:"soft",trailing:!1,onClick:B=>b(e)},{default:n(()=>[S(m(e.comments.total)+" Comments ",1)]),_:2},1032,["onClick"])]),"status-data":n(({row:e})=>[a(A,{size:"xs",label:U(e.status).text,color:U(e.status).color,variant:"subtle",class:"capitalize"},null,8,["label","color"])]),"file-data":n(({row:e})=>[e.file?(r(),C(M,{key:0,size:"sm",color:"primary",trailing:!1,onClick:B=>R(e.file)},{default:n(()=>[a(ae,{name:"file",class:"text-white"}),S(" Open Client File ")]),_:2},1032,["onClick"])):(r(),h("span",tt," No File Uploaded "))]),"actions-data":n(({row:e})=>[s("div",at,[e.actions.status==="pending"?(r(),C(H,{key:0,text:"Accept Order"},{default:n(()=>[a(M,{icon:"i-heroicons-check",size:"2xs",color:"green",variant:"outline",ui:{rounded:"rounded-full"},square:"",onClick:B=>y("Hang On","Are you sure you want to accept this order?","Accept Order","Cancel",()=>{l.updateUserStatus(e.user.id,"waitingpaid")})},null,8,["onClick"])]),_:2},1024)):F("",!0),e.actions.status==="waitingpaid"||e.actions.status==="paid"?(r(),C(H,{key:1,text:"Upload Works"},{default:n(()=>[a(M,{icon:"i-heroicons-arrow-up-tray",size:"2xs",color:"green",variant:"outline",ui:{rounded:"rounded-full"},square:"",onClick:B=>l.displayUploadFileModal(e.actions.id)},null,8,["onClick"])]),_:2},1024)):(r(),C(H,{key:2,text:"Verify"},{default:n(()=>[a(M,{icon:"i-heroicons-check",size:"2xs",color:"emerald",variant:"outline",ui:{rounded:"rounded-full"},square:"",onClick:B=>y("Verify Facilitator","Are you sure you want to verify this facilitator?","Verify","Cancel",()=>{l.updateUserStatus(e.user.id,"verified")})},null,8,["onClick"])]),_:2},1024))])]),_:1},8,["rows","loading"]),a(se,{modelValue:f.value,"onUpdate:modelValue":t[3]||(t[3]=e=>f.value=e),max:5,"page-count":D.value.itemsPerPage,total:D.value.totalPage},null,8,["modelValue","page-count","total"])]),_:1})])]),_:1}),a(he,{isOpen:V.value,data:j.value},null,8,["isOpen","data"]),a(qe,{isOpen:u.value,data:_.value,onHide:p,onRefresh:g},null,8,["isOpen","data"])])}}};export{wt as default};
