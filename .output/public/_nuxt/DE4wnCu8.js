import{_ as fe}from"./DhuoxZJn.js";import{_ as ae}from"./Mwcfg6V5.js";import{_ as Y}from"./pQbWsUYk.js";import{_ as oe}from"./dSNV757c.js";import{H as J,G,g as K,r as p,I as ve,S as ge,h as I,o as d,m as w,w as l,b as t,a,c as M,n as F,d as h,x as xe,t as x,v as te,j as le,F as ye,E as se,s as Q,y as ne,i as he,k as be,q as ke}from"./BSKzHnPj.js";import{_ as X}from"./DpvUxtYC.js";import{_ as we,a as Ce}from"./D3yMS55F.js";import{_ as $e}from"./q36-FHUY.js";import{_ as ie}from"./KX0IhSIY.js";import{_ as Oe}from"./BRXwIosz.js";import{_ as re}from"./HWga6m1v.js";import{_ as ce}from"./yf0Evo6_.js";import{u as Z}from"./Ck3765b6.js";import"./BgAKsO_4.js";import"./C1y44r8C.js";import"./Du0g8VFZ.js";import"./BkdCv88K.js";import"./Bt8Cigau.js";const Ue={class:"flex justify-between items-center w-full border-b border-1 pb-4"},je=a("h3",{class:"text-lg font-semibold w-full flex justify-center text-primary"}," Discussions ",-1),Se={class:"flex flex-col items-center justify-between w-full h-full py-2"},Me={key:0,class:"py-4 text-gray-400"},Fe={id:"comment-section",class:"w-full h-full max-h-screen overflow-auto px-2 py-2"},Ie={key:0,class:"pb-4"},Ve={class:"flex gap-2 items-center"},ze={class:"flex flex-col items-start gap-1"},De=a("span",{class:"font-semibold text-primary"}," You ",-1),Pe=a("span",{class:"capitalize"}," Faciliator ",-1),Re={class:"flex text-gray-700 my-3 text-sm"},Te={class:"text-gray-700 text-sm"},Ae={key:1,class:"pb-4"},Be={class:"flex gap-2 items-center"},Le={class:"flex flex-col items-start gap-1"},Ne={class:"font-semibold"},qe={class:"flex text-gray-700 my-3 text-sm"},He={class:"text-gray-700 text-sm"},Ee={class:"flex justify-end border-t border-1 pt-2 gap-2"},We={__name:"CommentSidebar",props:{isOpen:{type:Boolean,default:!1},data:{type:Object,default:()=>({id:0,price:0,comments:{data:[],total:0},callback:()=>{}})}},emits:["update:isOpen","hide","refresh"],setup(N,{emit:T}){const{updateMerchantOrder:A}=Z();J(),G();const O=K(),u=N,U=T,g=p(3),C=ve("token").value.user,m=p({user:{fullname:C.fullname,photo:C.photo},message:"",time:new Date().toISOString(),file_url:"",other_link:"",is_facilitator:!0}),b=ge(()=>u.data.comments.data.slice(0,g.value)),_=p(u.isOpen);I(()=>u.isOpen,c=>{_.value=c,c||k()}),I(_,c=>{U("update:isOpen",c)});const k=()=>{_.value=!1,U("hide")},j=c=>{const f=new Date,o=new Date(c),n=Math.floor((f-o)/1e3),r={year:31536e3,month:2592e3,week:604800,day:86400,hour:3600,minute:60,second:1};for(const y in r){const v=Math.floor(n/r[y]);if(v>=1)return v===1?`${v} ${y} ago`:`${v} ${y}s ago`}return"just now"},P=c=>{m.value.file_url=c},V=c=>{window.open(c,"_blank")},S=c=>{u.data.comments.data=c,U("refresh",u.data)},B=async c=>{const f=u.data.actions.id,o=u.data.comments.data??[];if(!c.message&&c.file_url&&(c.message="Here I attached a file."),!c.message&&!c.file_url){O.add({title:"Failed!",color:"red",icon:"i-heroicons-x-circle",description:"Comment message is required!"});return}o.push(c);try{const{data:n}=await A(f,{comment_json:o});O.add({title:"Success!",color:"green",icon:"i-heroicons-check-circle",description:"Order updated successfully!"}),S(o),g.value=o.length,setTimeout(()=>{const r=document.getElementById("comment-section");r.scrollTop=r.scrollHeight},2),m.value={user:{fullname:C.fullname,photo:C.photo},message:"",time:new Date().toISOString(),file_url:"",other_link:"",is_facilitator:!0}}catch(n){console.error("Updating order failed:",n),O.add({title:"Failed!",color:"red",icon:"i-heroicons-x-circle",description:"Failed to update order!"})}};return(c,f)=>{const o=X,n=se,r=Q,y=ne,v=oe,$=Y,z=Oe,R=re,i=ce;return d(),w(i,{modelValue:_.value,"onUpdate:modelValue":f[3]||(f[3]=e=>_.value=e),fullscreen:"","prevent-close":"",ui:{base:"!w-full sm:!w-[600px] absolute top-0 right-0 h-screen bg-white dark:bg-gray-800 rounded-l-3xl",rounded:"rounded-l-3xl rounded-r-0"}},{default:l(()=>[t($,{ui:{base:"h-full",ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800",rounded:"rounded-l-3xl rounded-r-0",body:{base:"flex flex-col justify-between h-full",padding:"px-6 py-5 sm:p-10"},header:{padding:"px-6 py-5 sm:px-8"},footer:{padding:"px-6 py-4 sm:px-10"}}},{default:l(()=>[a("div",Ue,[a("button",{onClick:k},[t(o,{name:"back",class:"text-2xl text-primary dark:text-gray-300"})]),je]),a("div",Se,[u.data.comments.total===0?(d(),M("div",Me," Start Discussion ")):F("",!0),g.value<u.data.comments.total?(d(),w(r,{key:1,block:"",color:"primary",variant:"soft",class:"my-4 bg-blue-100 hover:bg-blue-200",onClick:f[0]||(f[0]=e=>g.value=u.data.comments.total)},{default:l(()=>[t(n,{name:"i-heroicons-chat-bubble-oval-left-ellipsis"}),h(" Load Previous Comments ")]),_:1})):F("",!0),a("div",Fe,[(d(!0),M(ye,null,xe(le(b),e=>(d(),M("div",{key:e,class:"w-full"},[e.is_facilitator?(d(),M("div",Ie,[t($,{ui:{body:{base:"w-full",padding:"p-4 sm:p-4"}},class:"flex gap-4 items-center w-ful bg-gray-100"},{default:l(()=>[a("div",Ve,[t(y,{alt:e.user.fullname,src:e.user.photo,size:"md",imgClass:"object-cover"},null,8,["alt","src"]),a("div",ze,[De,t(v,{variant:"soft",size:"xs",color:"blue"},{default:l(()=>[Pe]),_:1})])]),a("div",Re,x(e.message),1),a("div",{class:te(["flex items-center",e.file_url?"justify-between":"justify-end"])},[e.file_url?(d(),w(r,{key:0,color:"green",variant:"soft",onClick:D=>V(e.file_url)},{default:l(()=>[t(n,{name:"i-heroicons-arrow-down-tray"}),h(" Attached File ")]),_:2},1032,["onClick"])):F("",!0),a("span",Te,x(j(new Date(e.time),{addSuffix:!0})),1)],2)]),_:2},1024)])):(d(),M("div",Ae,[t($,{ui:{body:{base:"w-full",padding:"p-4 sm:p-4"}},class:"flex gap-4 items-center w-full"},{default:l(()=>[a("div",Be,[t(y,{alt:e.user.fullname,src:e.user.photo,size:"md",imgClass:"object-cover"},null,8,["alt","src"]),a("div",Le,[a("span",Ne,x(e.user.fullname),1)])]),a("div",qe,x(e.message),1),a("div",{class:te(["flex items-center",e.file_url?"justify-between":"justify-end"])},[e.file_url?(d(),w(r,{key:0,color:"green",variant:"soft",onClick:D=>V(e.file_url)},{default:l(()=>[t(n,{name:"i-heroicons-arrow-down-tray"}),h(" Attached File ")]),_:2},1032,["onClick"])):F("",!0),a("span",He,x(j(new Date(e.time))),1)],2)]),_:2},1024)]))]))),128))])]),t($,{ui:{body:{base:"w-full",padding:"p-4 sm:p-2"}},class:"flex gap-4 items-center w-full"},{default:l(()=>[t(z,{modelValue:m.value.message,"onUpdate:modelValue":f[1]||(f[1]=e=>m.value.message=e),class:"w-full mb-2",placeholder:"Add Comment...",variant:"none"},null,8,["modelValue"]),a("div",Ee,[t(R,{"is-display-file":!1,accept:"*","max-size":"6291456",onFileUploaded:P}),t(r,{color:"primary",onClick:f[2]||(f[2]=e=>B(m.value))},{default:l(()=>[t(n,{name:"i-heroicons-paper-airplane"}),h(" Send ")]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},Ye=""+new URL("meeting.Myzv2aiY.svg",import.meta.url).href,Je={class:"flex justify-between items-center w-full border-b border-1 pb-4"},Ge=a("h3",{class:"text-lg font-semibold w-full flex justify-center text-primary"}," Upload Result ",-1),Ke={class:"flex flex-col w-full h-full my-4"},Qe=a("span",{class:"font-semibold py-4"}," Work Result ",-1),Xe={class:"flex flex-col"},Ze={class:"flex gap-2 justify-center items-center p-4"},et={class:"flex justify-center gap-2"},tt=a("span",{class:"font-semibold py-4"}," Setup a Meeting ",-1),at={class:"flex flex-col items-center"},ot=["src"],lt={class:"flex gap-2 justify-center items-center p-4 font-semibold text-lg"},st={class:"flex justify-center gap-2"},nt={class:"w-full flex justify-end"},it={__name:"UploadResultSidebar",props:{isOpen:{type:Boolean,default:!1},data:{type:Object}},emits:["update:isOpen","hide","refresh"],setup(N,{emit:T}){const{updateMerchantOrder:A}=Z();J(),G();const O=K(),u=N,U=T,g=p(u.isOpen);I(()=>u.isOpen,o=>{g.value=o,o||C()}),I(g,o=>{U("update:isOpen",o)});const C=()=>{g.value=!1,b.value=!1,_.value=!1,m.value={result_file_url:"",meet_url:""},U("hide")},m=p({result_file_url:"",meet_url:""}),b=p(!1),_=p(!1),k=p({title:"",message:"",callback:null}),j=o=>{m.value.result_file_url=o},P=(o,n,r,y,v)=>{k.value={title:o,content:n,confirmText:r,cancelText:y,callback:v},b.value=!0},V=o=>{window.open(o,"_blank")},S=o=>{navigator.clipboard.writeText(o),O.add({title:"Copied!",color:"green",icon:"i-heroicons-check-circle",description:"Meeting URL copied to clipboard!"})},B=o=>{S(o),V(o)};I(()=>u.data,o=>{o&&o.actions&&o.actions.meet_url&&(m.value.meet_url=o.actions.meet_url)},{immediate:!0,deep:!0});const c=o=>{const n={};for(const r in o)o[r]!==""&&o[r]!==null&&o[r]!==void 0&&(n[r]=o[r]);return n},f=async()=>{const o=u.data.actions.id;try{const{data:n}=await A(o,c({result_file_url:m.value.result_file_url,meet_url:m.value.meet_url}));O.add({title:"Success!",color:"green",icon:"i-heroicons-check-circle",description:"Order updated successfully!"}),C()}catch(n){console.error("Updating order failed:",n),O.add({title:"Failed!",color:"red",icon:"i-heroicons-x-circle",description:"Failed to update order!"})}};return(o,n)=>{const r=X,y=re,v=Y,$=Q,z=se,R=ae,i=ce;return d(),w(i,{modelValue:g.value,"onUpdate:modelValue":n[5]||(n[5]=e=>g.value=e),fullscreen:"","prevent-close":"",ui:{base:"!w-[600px] absolute top-0 right-0 h-screen bg-white dark:bg-gray-800 rounded-l-3xl",rounded:"rounded-l-3xl rounded-r-0"}},{default:l(()=>[t(v,{ui:{base:"h-full ",ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800",rounded:"rounded-l-3xl rounded-r-0",body:{base:"flex flex-col justify-between h-full",padding:"px-6 py-5 sm:p-10"},header:{padding:"px-6 py-5 sm:px-8"},footer:{padding:"px-6 py-4 sm:px-10"}}},{default:l(()=>[a("div",Je,[a("button",{onClick:C},[t(r,{name:"back",class:"text-2xl text-primary dark:text-gray-300"})]),Ge]),a("div",Ke,[Qe,!u.data.actions.result_file_url||_.value?(d(),w(v,{key:0,ui:{base:"w-full h-[200px] border-dashed border-2",body:{base:"w-full h-[200px] flex justify-center items-center"}},ref:"dropzone-file"},{default:l(()=>[t(y,{title:"Result",accept:"*",center:!0,"max-size":"6291456",onFileUploaded:j})]),_:1},512)):(d(),w(v,{key:1,ui:{base:"w-full h-[200px] ",body:{base:"w-full h-[200px] flex justify-center items-center"}},ref:"dropzone-file"},{default:l(()=>[a("div",Xe,[a("div",Ze,[t(r,{name:"file"}),h(" Your Past Result ")]),a("div",et,[t($,{icon:"i-heroicons-arrow-up-tray",onClick:n[0]||(n[0]=e=>P("Hang On","Are you sure you want to reupload this result?","Re Upload","Cancel",()=>_.value=!0))},{default:l(()=>[h(" Reupload ")]),_:1}),t($,{icon:"i-heroicons-arrow-down-tray",onClick:n[1]||(n[1]=e=>V(u.data.actions.result_file_url))},{default:l(()=>[h(" Download ")]),_:1})])])]),_:1},512)),tt,t(v,{ui:{base:"w-full ",body:{base:"flex justify-center items-center"}},ref:"dropzone-file"},{default:l(()=>[a("div",at,[a("img",{src:le(Ye),width:"200px",alt:""},null,8,ot),a("div",lt,[t(z,{name:"i-heroicons-video-camera"}),h(" Meeting Link ")]),a("div",st,[t(R,{modelValue:m.value.meet_url,"onUpdate:modelValue":n[2]||(n[2]=e=>m.value.meet_url=e)},null,8,["modelValue"]),u.data.actions.meet_url?(d(),w($,{key:0,color:"primary",onClick:n[3]||(n[3]=e=>B(m.value.meet_url))},{default:l(()=>[t(z,{name:"i-heroicons-video-camera"}),h(" Open ")]),_:1})):F("",!0)])])]),_:1},512)]),a("div",nt,[t($,{color:"primary",onClick:n[4]||(n[4]=e=>f())},{default:l(()=>[t(r,{name:"floppy"}),h(" Save ")]),_:1})])]),_:1}),t(ie,{isOpen:b.value,data:k.value},null,8,["isOpen","data"])]),_:1},8,["modelValue"])}}},rt={class:"pt-0 p-6 flex flex-col gap-2"},ct={class:"flex gap-2"},ut={key:0,class:"flex flex-col gap-1 items-start capitalize"},dt={class:"text-primary"},pt={key:1,class:"text-gray-300"},mt={class:"text-primary"},_t={class:"text-primary"},ft={class:"flex gap-3 items-center"},vt={class:"flex flex-col"},gt={class:"font-semibold text-primary"},xt={class:"text-sm text-gray-600"},yt={key:1,class:"text-gray-300"},ht={class:"flex gap-1"},bt="Order List",Bt={__name:"orders",setup(N){const{getMyMerchantOrders:T}=Z();K(),G();const A=J(),O=p(!0),u=p(!1),U=p(!1),g=p(!1),C=p({title:"",message:"",callback:null});p([]);const m=p([]),b=p({label:"All",value:"all"}),_=p(null),k=p(""),j=p(1),P=p({page:1,totalPage:1,totalItems:0,itemsPerPage:10}),V=[{label:"All",value:"all",color:"gray"},{label:"Completed",value:"completed",color:"orange"},{label:"Paid",value:"paid",color:"blue"},{label:"Pending",value:"pending",color:"orange"},{label:"Waiting Payment",value:"waitingpaid",color:"orange"},{label:"Failed",value:"failed",color:"orange"}],S=async()=>{try{await T({page:j.value,per_page:P.value.itemsPerPage,order_status:b.value.value==="all"?"":b.value.value,search:k.value}).then(i=>{m.value=i.data.data.orders.data.map((e,D)=>({no:D+1,service:{id:e.service.id,name:e.merchant.type,type:e.service.type},client:{id:e.user.id,fullname:e.user.fullname,email:e.user.email},"order date":o(e.created_at,"dd MMM yyyy"),estimated:`${e.service.time_estimated} ${e.service.time_estimated_unit}`,languages:{language_source:e.language_source,language_destination:e.language_destination},price:e.price,comments:{total:n(e.comment_json)?e.comment_json.length:0,data:e.comment_json||[]},status:e.order_status,file:e.user_file_url,actions:{id:e.id,status:e.order_status,result_file_url:e.result_file_url,meet_url:e.meet_url}}))})}catch(i){console.error("Error fetching merchant orders:",i)}finally{O.value=!1}};I(j,S),I(b,()=>{S()},{deep:!0}),I(k,ke(()=>{S()},300));const B=()=>{S(j.value,b.value.value,k.value)},c=i=>{window.open(i,"_blank")},f=i=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(i),o=i=>new Date(i).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}),n=i=>{try{return JSON.parse(i)}catch{return i}},r=i=>{_.value=i,console.log("Refreshed data:",_)},y=()=>{U.value=!1,g.value=!1,S()},v=(i,e,D,E,q)=>{C.value={title:i,content:e,confirmText:D,cancelText:E,callback:q},u.value=!0},$=i=>{_.value=i,U.value=!0},z=i=>{_.value=i,g.value=!0},R=i=>{switch(i){case"completed":return{color:"green",text:"Completed"};case"paid":return{color:"blue",text:"In Progress"};case"pending":return{color:"violet",text:"Pending"};case"waitingpaid":return{color:"orange",text:"Waiting"};case"failed":return{color:"red",text:"Failed"};default:return{color:"gray",text:"Unknown"}}};return he(()=>{const i=A.query.detail_id;i&&(k.value=i),S()}),(i,e)=>{const D=fe,E=ae,q=Y,ee=oe,ue=ne,L=Q,de=X,W=we,pe=$e,me=Ce,_e=be;return d(),M("div",null,[t(_e,{name:"merchant"},{default:l(()=>[a("div",rt,[t(q,{ui:{body:{base:"flex justify-between items-center w-full",background:"",padding:"p-2 sm:p-4"}}},{default:l(()=>[a("h6",{class:"font-semibold"},x(bt)),a("div",ct,[t(D,{options:V,modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=s=>b.value=s),placeholder:"Pilih Status",by:"value","option-attribute":"label","search-attributes":["label"],onChange:B,class:"max-w-[180px]"},null,8,["modelValue"]),t(E,{icon:"i-heroicons-magnifying-glass-20-solid",size:"sm",color:"white",trailing:!1,placeholder:"Search Order",modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=s=>k.value=s)},null,8,["modelValue"])])]),_:1}),t(q,{ui:{body:{base:"flex flex-col gap-4"}}},{default:l(()=>[t(pe,{rows:m.value,loading:O.value,"loading-state":{icon:"i-heroicons-arrow-path-20-solid",label:"Loading..."},ui:{wrapper:"max-w-full relative overflow-x-auto",base:" table-fixed overflow-x-auto"}},{"service-data":l(({row:s})=>[s.service?(d(),M("div",ut,[a("span",dt,x(s.service.name)+" Service ",1),t(ee,{variant:"soft",color:"orange",class:"capitalize"},{default:l(()=>[h(x(s.service.type),1)]),_:2},1024)])):(d(),M("span",pt," Kosong "))]),"price-data":l(({row:s})=>[a("span",mt,x(f(s.price)),1)]),"languages-data":l(({row:s})=>[a("span",_t,x(s.languages.language_source.name)+" -> "+x(s.languages.language_destination.name),1)]),"client-data":l(({row:s})=>[a("div",ft,[t(ue,{src:s.client.photo,alt:s.client.fullname,size:"sm",variant:"rounded-full",imgClass:"object-cover"},null,8,["src","alt"]),a("div",vt,[a("span",gt,x(s.client.fullname),1),a("span",xt,x(s.client.email),1)])])]),"comments-data":l(({row:s})=>[t(L,{size:"sm",color:"blue",variant:"soft",trailing:!1,onClick:H=>$(s)},{default:l(()=>[h(x(s.comments.total)+" Comments ",1)]),_:2},1032,["onClick"])]),"status-data":l(({row:s})=>[t(ee,{size:"xs",label:R(s.status).text,color:R(s.status).color,variant:"subtle",class:"capitalize"},null,8,["label","color"])]),"file-data":l(({row:s})=>[s.file?(d(),w(L,{key:0,size:"sm",color:"primary",trailing:!1,onClick:H=>c(s.file)},{default:l(()=>[t(de,{name:"file",class:"text-white"}),h(" Open Client File ")]),_:2},1032,["onClick"])):(d(),M("span",yt," No File Uploaded "))]),"actions-data":l(({row:s})=>[a("div",ht,[s.actions.status==="pending"?(d(),w(W,{key:0,text:"Accept Order"},{default:l(()=>[t(L,{icon:"i-heroicons-check",size:"2xs",color:"green",variant:"outline",ui:{rounded:"rounded-full"},square:"",onClick:H=>{v("Hang On","Are you sure you want to accept this order?","Accept Order","Cancel",()=>{i.updateUserStatus(s.user.id,"waitingpaid")})}},null,8,["onClick"])]),_:2},1024)):F("",!0),s.actions.status==="paid"?(d(),w(W,{key:1,text:"Upload Works"},{default:l(()=>[t(L,{icon:"i-heroicons-arrow-up-tray",size:"2xs",color:"green",variant:"outline",ui:{rounded:"rounded-full"},square:"",onClick:H=>z(s)},null,8,["onClick"])]),_:2},1024)):F("",!0),s.actions.status==="completed"?(d(),w(W,{key:2,text:"Check Result"},{default:l(()=>[t(L,{icon:"i-heroicons-arrow-top-right-on-square",size:"2xs",color:"blue",variant:"outline",ui:{rounded:"rounded-full"},square:"",onClick:H=>z(s)},null,8,["onClick"])]),_:2},1024)):F("",!0)])]),_:1},8,["rows","loading"]),t(me,{modelValue:j.value,"onUpdate:modelValue":e[2]||(e[2]=s=>j.value=s),"page-count":1,total:P.value.totalPage},null,8,["modelValue","total"])]),_:1})])]),_:1}),t(ie,{isOpen:u.value,data:C.value},null,8,["isOpen","data"]),t(We,{isOpen:U.value,data:_.value,onHide:y,onRefresh:r},null,8,["isOpen","data"]),t(it,{isOpen:g.value,data:_.value,onHide:y,onRefresh:r},null,8,["isOpen","data"])])}}};export{Bt as default};
