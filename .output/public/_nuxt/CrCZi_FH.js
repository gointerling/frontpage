import{_ as fe}from"./DL153v74.js";import{_ as ae}from"./D9Tq0se6.js";import{_ as K}from"./fMf9s-QS.js";import{_ as oe}from"./Cv-5lGWN.js";import{x as le,L as se,g as Q,r as m,B as ge,D as ve,h as A,o as d,l as k,w as s,b as t,a,c as j,q as T,d as h,m as xe,t as v,n as te,k as G,F as ye,a0 as ne,s as X,v as ie,i as he,j as be}from"./BqGgLAbD.js";import{_ as Z}from"./BmZ1ThBO.js";import{_ as ke,a as we}from"./BUJINjYz.js";import{_ as Ce}from"./CVt25eAw.js";import{_ as re}from"./BGcfErfh.js";import{_ as $e}from"./YxEVfjF3.js";import{_ as ce}from"./FiNmAi7i.js";import{_ as ue}from"./CG0a7XMq.js";import{u as ee}from"./CFC3nTEj.js";import"./Cu9O3nsD.js";import"./HhIP9DG2.js";import"./CjHJVWap.js";import"./lC83U2vb.js";import"./Gzy-iuwg.js";import"./CGwzmjpp.js";const Oe={class:"flex justify-between items-center w-full border-b border-1 pb-4"},Ue=a("h3",{class:"text-lg font-semibold w-full flex justify-center text-primary"}," Discussions ",-1),je={class:"flex flex-col items-center justify-between w-full h-full"},Se={key:0,class:"py-4 text-gray-400"},Me={id:"comment-section",class:"w-full h-full max-h-[550px] overflow-auto px-2 py-1"},Fe={key:0,class:"pb-4"},Ie={class:"flex gap-2 items-center"},Ve={class:"flex flex-col items-start gap-1"},ze=a("span",{class:"font-semibold text-primary"}," You ",-1),De=a("span",{class:"capitalize"}," Faciliator ",-1),Pe={class:"flex text-gray-700 my-3 text-sm"},Re={class:"text-gray-700 text-sm"},Te={key:1,class:"pb-4"},Ae={class:"flex gap-2 items-center"},Be={class:"flex flex-col items-start gap-1"},Le={class:"font-semibold"},Ne={class:"flex text-gray-700 my-3 text-sm"},qe={class:"text-gray-700 text-sm"},He={class:"flex justify-end border-t border-1 pt-2 gap-2"},Ee={__name:"CommentSidebar",props:{isOpen:{type:Boolean,default:!1},data:{type:Object,default:()=>({id:0,price:0,comments:{data:[],total:0},callback:()=>{}})}},emits:["update:isOpen","hide","refresh"],setup(H,{emit:B}){const{updateMerchantOrder:D}=ee();le(),se();const O=Q(),u=H,U=B,x=m(3),w=ge("token").value.user,p=m({user:{fullname:w.fullname,photo:w.photo},message:"",time:new Date().toISOString(),file_url:"",other_link:"",is_facilitator:!0}),b=ve(()=>u.data.comments.data.slice(0,x.value)),g=m(u.isOpen);A(()=>u.isOpen,c=>{g.value=c,c||C()}),A(g,c=>{U("update:isOpen",c)});const C=()=>{g.value=!1,U("hide")},S=c=>{const _=new Date,o=new Date(c),n=Math.floor((_-o)/1e3),r={year:31536e3,month:2592e3,week:604800,day:86400,hour:3600,minute:60,second:1};for(const y in r){const f=Math.floor(n/r[y]);if(f>=1)return f===1?`${f} ${y} ago`:`${f} ${y}s ago`}return"just now"},M=c=>{p.value.file_url=c},F=c=>{window.open(c,"_blank")},L=c=>{u.data.comments.data=c,U("refresh",u.data)},N=async c=>{const _=u.data.actions.id,o=u.data.comments.data??[];if(!c.message&&c.file_url&&(c.message="Here I attached a file."),!c.message&&!c.file_url){O.add({title:"Failed!",color:"red",icon:"i-heroicons-x-circle",description:"Comment message is required!"});return}o.push(c);try{const{data:n}=await D(_,{comment_json:o});O.add({title:"Success!",color:"green",icon:"i-heroicons-check-circle",description:"Order updated successfully!"}),L(o),x.value=o.length,setTimeout(()=>{const r=document.getElementById("comment-section");r.scrollTop=r.scrollHeight},2),p.value={user:{fullname:w.fullname,photo:w.photo},message:"",time:new Date().toISOString(),file_url:"",other_link:"",is_facilitator:!0}}catch(n){console.error("Updating order failed:",n),O.add({title:"Failed!",color:"red",icon:"i-heroicons-x-circle",description:"Failed to update order!"})}};return(c,_)=>{const o=Z,n=ne,r=X,y=ie,f=oe,$=K,V=$e,P=ce,i=ue;return d(),k(i,{modelValue:g.value,"onUpdate:modelValue":_[3]||(_[3]=e=>g.value=e),fullscreen:"","prevent-close":"",ui:{base:"!w-[600px] absolute top-0 right-0 h-screen bg-white dark:bg-gray-800 rounded-l-3xl",rounded:"rounded-l-3xl rounded-r-0"}},{default:s(()=>[t($,{ui:{base:"h-full ",ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800",rounded:"rounded-l-3xl rounded-r-0",body:{base:"flex flex-col justify-between h-full",padding:"px-6 py-5 sm:p-10"},header:{padding:"px-6 py-5 sm:px-8"},footer:{padding:"px-6 py-4 sm:px-10"}}},{default:s(()=>[a("div",Oe,[a("button",{onClick:C},[t(o,{name:"back",class:"text-2xl text-primary dark:text-gray-300"})]),Ue]),a("div",je,[u.data.comments.total===0?(d(),j("div",Se," Start Discussion ")):T("",!0),x.value<u.data.comments.total?(d(),k(r,{key:1,block:"",color:"primary",variant:"soft",class:"my-4 bg-blue-100 hover:bg-blue-200",onClick:_[0]||(_[0]=e=>x.value=u.data.comments.total)},{default:s(()=>[t(n,{name:"i-heroicons-chat-bubble-oval-left-ellipsis"}),h(" Load Previous Comments ")]),_:1})):T("",!0),a("div",Me,[(d(!0),j(ye,null,xe(G(b),e=>(d(),j("div",{key:e,class:"w-full"},[e.is_facilitator?(d(),j("div",Fe,[t($,{ui:{body:{base:"w-full",padding:"p-4 sm:p-4"}},class:"flex gap-4 items-center w-ful bg-gray-100"},{default:s(()=>[a("div",Ie,[t(y,{alt:e.user.fullname,src:e.user.photo,size:"md",imgClass:"object-cover"},null,8,["alt","src"]),a("div",Ve,[ze,t(f,{variant:"soft",size:"xs",color:"blue"},{default:s(()=>[De]),_:1})])]),a("div",Pe,v(e.message),1),a("div",{class:te(["flex items-center",e.file_url?"justify-between":"justify-end"])},[e.file_url?(d(),k(r,{key:0,color:"green",variant:"soft",onClick:I=>F(e.file_url)},{default:s(()=>[t(n,{name:"i-heroicons-arrow-down-tray"}),h(" Attached File ")]),_:2},1032,["onClick"])):T("",!0),a("span",Re,v(S(new Date(e.time),{addSuffix:!0})),1)],2)]),_:2},1024)])):(d(),j("div",Te,[t($,{ui:{body:{base:"w-full",padding:"p-4 sm:p-4"}},class:"flex gap-4 items-center w-full"},{default:s(()=>[a("div",Ae,[t(y,{alt:e.user.fullname,src:e.user.photo,size:"md",imgClass:"object-cover"},null,8,["alt","src"]),a("div",Be,[a("span",Le,v(e.user.fullname),1)])]),a("div",Ne,v(e.message),1),a("div",{class:te(["flex items-center",e.file_url?"justify-between":"justify-end"])},[e.file_url?(d(),k(r,{key:0,color:"green",variant:"soft",onClick:I=>F(e.file_url)},{default:s(()=>[t(n,{name:"i-heroicons-arrow-down-tray"}),h(" Attached File ")]),_:2},1032,["onClick"])):T("",!0),a("span",qe,v(S(new Date(e.time))),1)],2)]),_:2},1024)]))]))),128))])]),t($,{ui:{body:{base:"w-full",padding:"p-4 sm:p-2"}},class:"flex gap-4 items-center w-full"},{default:s(()=>[t(V,{modelValue:p.value.message,"onUpdate:modelValue":_[1]||(_[1]=e=>p.value.message=e),class:"w-full mb-2",placeholder:"Add Comment...",variant:"none"},null,8,["modelValue"]),a("div",He,[t(P,{"is-display-file":!1,accept:"*","max-size":"6291456",onFileUploaded:M}),t(r,{color:"primary",onClick:_[2]||(_[2]=e=>N(p.value))},{default:s(()=>[t(n,{name:"i-heroicons-paper-airplane"}),h(" Send ")]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},Ye=""+new URL("meeting.Myzv2aiY.svg",import.meta.url).href,Je={class:"flex justify-between items-center w-full border-b border-1 pb-4"},We=a("h3",{class:"text-lg font-semibold w-full flex justify-center text-primary"}," Upload Result ",-1),Ke={class:"flex flex-col w-full h-full my-4"},Qe=a("span",{class:"font-semibold py-4"}," Work Result ",-1),Ge={class:"flex flex-col"},Xe={class:"flex gap-2 justify-center items-center p-4"},Ze={class:"flex justify-center gap-2"},et=a("span",{class:"font-semibold py-4"}," Setup a Meeting ",-1),tt={class:"flex flex-col items-center"},at=["src"],ot={class:"flex gap-2 justify-center items-center p-4 font-semibold text-lg"},lt={class:"flex justify-center gap-2"},st={class:"w-full flex justify-end"},nt={__name:"UploadResultSidebar",props:{isOpen:{type:Boolean,default:!1},data:{type:Object}},emits:["update:isOpen","hide","refresh"],setup(H,{emit:B}){const{updateMerchantOrder:D}=ee();le(),se();const O=Q(),u=H,U=B,x=m(u.isOpen);A(()=>u.isOpen,o=>{x.value=o,o||w()}),A(x,o=>{U("update:isOpen",o)});const w=()=>{x.value=!1,b.value=!1,g.value=!1,p.value={result_file_url:"",meet_url:""},U("hide")},p=m({result_file_url:"",meet_url:""}),b=m(!1),g=m(!1),C=m({title:"",message:"",callback:null}),S=o=>{p.value.result_file_url=o},M=(o,n,r,y,f)=>{C.value={title:o,content:n,confirmText:r,cancelText:y,callback:f},b.value=!0},F=o=>{window.open(o,"_blank")},L=o=>{navigator.clipboard.writeText(o),O.add({title:"Copied!",color:"green",icon:"i-heroicons-check-circle",description:"Meeting URL copied to clipboard!"})},N=o=>{L(o),F(o)};A(()=>u.data,o=>{o&&o.actions&&o.actions.meet_url&&(p.value.meet_url=o.actions.meet_url)},{immediate:!0,deep:!0});const c=o=>{const n={};for(const r in o)o[r]!==""&&o[r]!==null&&o[r]!==void 0&&(n[r]=o[r]);return n},_=async()=>{const o=u.data.actions.id;try{const{data:n}=await D(o,c({result_file_url:p.value.result_file_url,meet_url:p.value.meet_url}));O.add({title:"Success!",color:"green",icon:"i-heroicons-check-circle",description:"Order updated successfully!"}),w()}catch(n){console.error("Updating order failed:",n),O.add({title:"Failed!",color:"red",icon:"i-heroicons-x-circle",description:"Failed to update order!"})}};return(o,n)=>{const r=Z,y=ce,f=K,$=X,V=ne,P=ae,i=ue;return d(),k(i,{modelValue:x.value,"onUpdate:modelValue":n[5]||(n[5]=e=>x.value=e),fullscreen:"","prevent-close":"",ui:{base:"!w-[600px] absolute top-0 right-0 h-screen bg-white dark:bg-gray-800 rounded-l-3xl",rounded:"rounded-l-3xl rounded-r-0"}},{default:s(()=>[t(f,{ui:{base:"h-full ",ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800",rounded:"rounded-l-3xl rounded-r-0",body:{base:"flex flex-col justify-between h-full",padding:"px-6 py-5 sm:p-10"},header:{padding:"px-6 py-5 sm:px-8"},footer:{padding:"px-6 py-4 sm:px-10"}}},{default:s(()=>[a("div",Je,[a("button",{onClick:w},[t(r,{name:"back",class:"text-2xl text-primary dark:text-gray-300"})]),We]),a("div",Ke,[Qe,!u.data.actions.result_file_url||g.value?(d(),k(f,{key:0,ui:{base:"w-full h-[200px] border-dashed border-2",body:{base:"w-full h-[200px] flex justify-center items-center"}},ref:"dropzone-file"},{default:s(()=>[t(y,{title:"Result",accept:"*",center:!0,"max-size":"6291456",onFileUploaded:S})]),_:1},512)):(d(),k(f,{key:1,ui:{base:"w-full h-[200px] ",body:{base:"w-full h-[200px] flex justify-center items-center"}},ref:"dropzone-file"},{default:s(()=>[a("div",Ge,[a("div",Xe,[t(r,{name:"file"}),h(" Your Past Result ")]),a("div",Ze,[t($,{icon:"i-heroicons-arrow-up-tray",onClick:n[0]||(n[0]=e=>M("Hang On","Are you sure you want to reupload this result?","Re Upload","Cancel",()=>g.value=!0))},{default:s(()=>[h(" Reupload ")]),_:1}),t($,{icon:"i-heroicons-arrow-down-tray",onClick:n[1]||(n[1]=e=>F(u.data.actions.result_file_url))},{default:s(()=>[h(" Download ")]),_:1})])])]),_:1},512)),et,t(f,{ui:{base:"w-full ",body:{base:"flex justify-center items-center"}},ref:"dropzone-file"},{default:s(()=>[a("div",tt,[a("img",{src:G(Ye),width:"200px",alt:""},null,8,at),a("div",ot,[t(V,{name:"i-heroicons-video-camera"}),h(" Meeting Link ")]),a("div",lt,[t(P,{modelValue:p.value.meet_url,"onUpdate:modelValue":n[2]||(n[2]=e=>p.value.meet_url=e)},null,8,["modelValue"]),u.data.actions.meet_url?(d(),k($,{key:0,color:"primary",onClick:n[3]||(n[3]=e=>N(p.value.meet_url))},{default:s(()=>[t(V,{name:"i-heroicons-video-camera"}),h(" Open ")]),_:1})):T("",!0)])])]),_:1},512)]),a("div",st,[t($,{color:"primary",onClick:n[4]||(n[4]=e=>_())},{default:s(()=>[t(r,{name:"floppy"}),h(" Save ")]),_:1})])]),_:1}),t(re,{isOpen:b.value,data:C.value},null,8,["isOpen","data"])]),_:1},8,["modelValue"])}}},it={class:"pt-0 p-6 flex flex-col gap-2"},rt={class:"flex gap-2"},ct={key:0,class:"flex flex-col gap-1 items-start capitalize"},ut={class:"text-primary"},dt={key:1,class:"text-gray-300"},pt={class:"text-primary"},mt={class:"text-primary"},_t={class:"flex gap-3 items-center"},ft={class:"flex flex-col"},gt={class:"font-semibold text-primary"},vt={class:"text-sm text-gray-600"},xt={key:1,class:"text-gray-300"},yt={class:"flex gap-1"},ht="Order List",Bt={__name:"orders",setup(H){const{getMyMerchantOrders:B}=ee();Q();const D=m(!0),O=m(!1),u=m(!1),U=m(!1),x=m({title:"",message:"",callback:null});m([]);const w=m([]),p=m({label:"All",value:"all"}),b=m(null),g=m(""),C=m(1),S=m({page:1,totalPage:1,totalItems:0,itemsPerPage:10}),M=async()=>{try{await B({page:C.value,per_page:S.value.itemsPerPage,status:p.value.value==="all"?"":p.value.value,search:g.value}).then(i=>{w.value=i.data.data.orders.data.map((e,I)=>({no:I+1,service:{id:e.service.id,name:e.merchant.type,type:e.service.type},buyer:{id:e.user.id,fullname:e.user.fullname,email:e.user.email},"order date":o(e.created_at,"dd MMM yyyy"),estimated:`${e.service.time_estimated} ${e.service.time_estimated_unit}`,languages:{language_source:e.language_source,language_destination:e.language_destination},price:e.price,comments:{total:n(e.comment_json)?e.comment_json.length:0,data:e.comment_json||[]},status:e.order_status,file:e.user_file_url,actions:{id:e.id,status:e.order_status,result_file_url:e.result_file_url,meet_url:e.meet_url}}))})}catch(i){console.error("Error fetching merchant orders:",i)}finally{D.value=!1}};A(C,M);const F=()=>{M(C.value,p.value.value,g.value)},L=N(()=>{F()},500);function N(i,e,I){let z;return function(){const R=this,E=arguments,J=function(){z=null,i.apply(R,E)};clearTimeout(z),z=setTimeout(J,e)}}const c=i=>{window.open(i,"_blank")},_=i=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(i),o=i=>new Date(i).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}),n=i=>{try{return JSON.parse(i)}catch{return i}},r=i=>{b.value=i,console.log("Refreshed data:",b)},y=()=>{u.value=!1,U.value=!1,M()},f=(i,e,I,z,R)=>{x.value={title:i,content:e,confirmText:I,cancelText:z,callback:R},O.value=!0},$=i=>{b.value=i,u.value=!0},V=i=>{b.value=i,U.value=!0},P=i=>{switch(i){case"completed":return{color:"green",text:"Completed"};case"paid":return{color:"blue",text:"In Progress"};case"pending":return{color:"violet",text:"Pending"};case"waitingpaid":return{color:"orange",text:"Approved"};case"failed":return{color:"red",text:"Failed"};default:return{color:"gray",text:"Unknown"}}};return he(()=>{M()}),(i,e)=>{const I=fe,z=ae,R=K,E=oe,J=ie,q=X,de=Z,W=ke,pe=Ce,me=we,_e=be;return d(),j("div",null,[t(_e,{name:"merchant"},{default:s(()=>[a("div",it,[t(R,{ui:{body:{base:"flex justify-between items-center w-full",background:"",padding:"p-2 sm:p-4"}}},{default:s(()=>[a("h6",{class:"font-semibold"},v(ht)),a("div",rt,[t(I,{options:[{label:"All",value:"all",color:"gray"},{label:"Completed",value:"completed",color:"orange"},{label:"In Progress",value:"paid",color:"blue"},{label:"Pending",value:"pending",color:"orange"},{label:"In Progress",value:"waitingpaid",color:"orange"},{label:"Failed",value:"failed",color:"orange"}],modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=l=>p.value=l),placeholder:"Pilih Status",by:"value","option-attribute":"label","search-attributes":["label"],onChange:F,class:"max-w-[180px]"},null,8,["modelValue"]),t(z,{icon:"i-heroicons-magnifying-glass-20-solid",size:"sm",color:"white",trailing:!1,placeholder:"Search Order",modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=l=>g.value=l),onInput:e[2]||(e[2]=l=>G(L)())},null,8,["modelValue"])])]),_:1}),t(R,{ui:{body:{base:"flex flex-col gap-4"}}},{default:s(()=>[t(pe,{rows:w.value,loading:D.value,"loading-state":{icon:"i-heroicons-arrow-path-20-solid",label:"Loading..."},ui:{wrapper:"max-w-full relative overflow-x-auto",base:" table-fixed overflow-x-auto"}},{"service-data":s(({row:l})=>[l.service?(d(),j("div",ct,[a("span",ut,v(l.service.name)+" Service ",1),t(E,{variant:"soft",color:"orange",class:"capitalize"},{default:s(()=>[h(v(l.service.type),1)]),_:2},1024)])):(d(),j("span",dt," Kosong "))]),"price-data":s(({row:l})=>[a("span",pt,v(_(l.price)),1)]),"languages-data":s(({row:l})=>[a("span",mt,v(l.languages.language_source.name)+" -> "+v(l.languages.language_destination.name),1)]),"buyer-data":s(({row:l})=>[a("div",_t,[t(J,{src:l.buyer.photo,alt:l.buyer.fullname,size:"sm",variant:"rounded-full",imgClass:"object-cover"},null,8,["src","alt"]),a("div",ft,[a("span",gt,v(l.buyer.fullname),1),a("span",vt,v(l.buyer.email),1)])])]),"comments-data":s(({row:l})=>[t(q,{size:"sm",color:"blue",variant:"soft",trailing:!1,onClick:Y=>$(l)},{default:s(()=>[h(v(l.comments.total)+" Comments ",1)]),_:2},1032,["onClick"])]),"status-data":s(({row:l})=>[t(E,{size:"xs",label:P(l.status).text,color:P(l.status).color,variant:"subtle",class:"capitalize"},null,8,["label","color"])]),"file-data":s(({row:l})=>[l.file?(d(),k(q,{key:0,size:"sm",color:"primary",trailing:!1,onClick:Y=>c(l.file)},{default:s(()=>[t(de,{name:"file",class:"text-white"}),h(" Open Client File ")]),_:2},1032,["onClick"])):(d(),j("span",xt," No File Uploaded "))]),"actions-data":s(({row:l})=>[a("div",yt,[l.actions.status==="pending"?(d(),k(W,{key:0,text:"Accept Order"},{default:s(()=>[t(q,{icon:"i-heroicons-check",size:"2xs",color:"green",variant:"outline",ui:{rounded:"rounded-full"},square:"",onClick:Y=>f("Hang On","Are you sure you want to accept this order?","Accept Order","Cancel",()=>{i.updateUserStatus(l.user.id,"waitingpaid")})},null,8,["onClick"])]),_:2},1024)):T("",!0),l.actions.status==="waitingpaid"||l.actions.status==="paid"?(d(),k(W,{key:1,text:"Upload Works"},{default:s(()=>[t(q,{icon:"i-heroicons-arrow-up-tray",size:"2xs",color:"green",variant:"outline",ui:{rounded:"rounded-full"},square:"",onClick:Y=>V(l)},null,8,["onClick"])]),_:2},1024)):(d(),k(W,{key:2,text:"Check Result"},{default:s(()=>[t(q,{icon:"i-heroicons-arrow-top-right-on-square",size:"2xs",color:"blue",variant:"outline",ui:{rounded:"rounded-full"},square:"",onClick:Y=>V(l)},null,8,["onClick"])]),_:2},1024))])]),_:1},8,["rows","loading"]),t(me,{modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=l=>C.value=l),max:5,"page-count":S.value.itemsPerPage,total:S.value.totalPage},null,8,["modelValue","page-count","total"])]),_:1})])]),_:1}),t(re,{isOpen:O.value,data:x.value},null,8,["isOpen","data"]),t(Ee,{isOpen:u.value,data:b.value,onHide:y,onRefresh:r},null,8,["isOpen","data"]),t(nt,{isOpen:U.value,data:b.value,onHide:y,onRefresh:r},null,8,["isOpen","data"])])}}};export{Bt as default};
