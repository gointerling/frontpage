import{_ as _e}from"./DsipYafI.js";import{_ as Z}from"./ccVIBgiN.js";import{_ as W}from"./kOUxhDdY.js";import{_ as ee}from"./CcMtSYFD.js";import{H as te,G as ae,g as Y,r as _,I as fe,S as ve,h as V,o as m,m as $,w as l,b as e,a as t,c as M,n as F,d as h,x as ge,t as x,v as X,j as oe,F as xe,E as le,s as J,y as se,i as ye,k as he,q as be}from"./3LrDIpDG.js";import{_ as G}from"./2riXc9X8.js";import{_ as ke,a as we}from"./CO19Vh0Y.js";import{_ as Ce}from"./DPcslFGJ.js";import{_ as ne}from"./DWSBCIXQ.js";import{_ as $e}from"./BTpWs5uI.js";import{_ as ie}from"./BBiYkULQ.js";import{_ as re}from"./Ddjm6nak.js";import{u as K}from"./Cgufi-90.js";import"./BCv28JP3.js";import"./B5wJ3qZ_.js";import"./BsvOyQW3.js";import"./CdrHH_tn.js";import"./DgL-Hby9.js";const Oe={class:"flex justify-between items-center w-full border-b border-1 pb-4"},Ue=t("h3",{class:"text-lg font-semibold w-full flex justify-center text-primary"}," Discussions ",-1),je={class:"flex flex-col items-center justify-between w-full h-full py-2"},Se={key:0,class:"py-4 text-gray-400"},Me={id:"comment-section",class:"w-full h-full max-h-screen overflow-auto px-2 py-2"},Fe={key:0,class:"pb-4"},Ve={class:"flex gap-2 items-center"},ze={class:"flex flex-col items-start gap-1"},Ie=t("span",{class:"font-semibold text-primary"}," You ",-1),De=t("span",{class:"capitalize"}," Faciliator ",-1),Pe={class:"flex text-gray-700 my-3 text-sm"},Re={class:"text-gray-700 text-sm"},Te={key:1,class:"pb-4"},Ae={class:"flex gap-2 items-center"},Be={class:"flex flex-col items-start gap-1"},Le={class:"font-semibold"},Ne={class:"flex text-gray-700 my-3 text-sm"},He={class:"text-gray-700 text-sm"},qe={class:"flex justify-end border-t border-1 pt-2 gap-2"},Ee={__name:"CommentSidebar",props:{isOpen:{type:Boolean,default:!1},data:{type:Object,default:()=>({id:0,price:0,comments:{data:[],total:0},callback:()=>{}})}},emits:["update:isOpen","hide","refresh"],setup(N,{emit:P}){const{updateMerchantOrder:D}=K();te(),ae();const j=Y(),d=N,S=P,y=_(3),O=fe("token").value.user,p=_({user:{fullname:O.fullname,photo:O.photo},message:"",time:new Date().toISOString(),file_url:"",other_link:"",is_facilitator:!0}),b=ve(()=>d.data.comments.data.slice(0,y.value)),v=_(d.isOpen);V(()=>d.isOpen,u=>{v.value=u,u||U()}),V(v,u=>{S("update:isOpen",u)});const U=()=>{v.value=!1,S("hide")},z=u=>{const f=new Date,a=new Date(u),i=Math.floor((f-a)/1e3),c={year:31536e3,month:2592e3,week:604800,day:86400,hour:3600,minute:60,second:1};for(const w in c){const g=Math.floor(i/c[w]);if(g>=1)return g===1?`${g} ${w} ago`:`${g} ${w}s ago`}return"just now"},R=u=>{p.value.file_url=u},k=u=>{window.open(u,"_blank")},T=u=>{d.data.comments.data=u,S("refresh",d.data)},A=async u=>{const f=d.data.actions.id,a=d.data.comments.data??[];if(!u.message&&u.file_url&&(u.message="Here I attached a file."),!u.message&&!u.file_url){j.add({title:"Failed!",color:"red",icon:"i-heroicons-x-circle",description:"Comment message is required!"});return}a.push(u);try{const{data:i}=await D(f,{comment_json:a});j.add({title:"Success!",color:"green",icon:"i-heroicons-check-circle",description:"Order updated successfully!"}),T(a),y.value=a.length,setTimeout(()=>{const c=document.getElementById("comment-section");c.scrollTop=c.scrollHeight},2),p.value={user:{fullname:O.fullname,photo:O.photo},message:"",time:new Date().toISOString(),file_url:"",other_link:"",is_facilitator:!0}}catch(i){console.error("Updating order failed:",i),j.add({title:"Failed!",color:"red",icon:"i-heroicons-x-circle",description:"Failed to update order!"})}};return(u,f)=>{const a=G,i=le,c=J,w=se,g=ee,C=W,I=$e,r=ie,s=re;return m(),$(s,{modelValue:v.value,"onUpdate:modelValue":f[3]||(f[3]=o=>v.value=o),fullscreen:"","prevent-close":"",ui:{base:"!w-full sm:!w-[600px] absolute top-0 right-0 h-screen bg-white dark:bg-gray-800 rounded-l-3xl",rounded:"rounded-l-3xl rounded-r-0"}},{default:l(()=>[e(C,{ui:{base:"h-full",ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800",rounded:"rounded-l-3xl rounded-r-0",body:{base:"flex flex-col justify-between h-full",padding:"px-6 py-5 sm:p-10"},header:{padding:"px-6 py-5 sm:px-8"},footer:{padding:"px-6 py-4 sm:px-10"}}},{default:l(()=>[t("div",Oe,[t("button",{onClick:U},[e(a,{name:"back",class:"text-2xl text-primary dark:text-gray-300"})]),Ue]),t("div",je,[d.data.comments.total===0?(m(),M("div",Se," Start Discussion ")):F("",!0),y.value<d.data.comments.total?(m(),$(c,{key:1,block:"",color:"primary",variant:"soft",class:"my-4 bg-blue-100 hover:bg-blue-200",onClick:f[0]||(f[0]=o=>y.value=d.data.comments.total)},{default:l(()=>[e(i,{name:"i-heroicons-chat-bubble-oval-left-ellipsis"}),h(" Load Previous Comments ")]),_:1})):F("",!0),t("div",Me,[(m(!0),M(xe,null,ge(oe(b),o=>(m(),M("div",{key:o,class:"w-full"},[o.is_facilitator?(m(),M("div",Fe,[e(C,{ui:{body:{base:"w-full",padding:"p-4 sm:p-4"}},class:"flex gap-4 items-center w-ful bg-gray-100"},{default:l(()=>[t("div",Ve,[e(w,{alt:o.user.fullname,src:o.user.photo,size:"md",imgClass:"object-cover"},null,8,["alt","src"]),t("div",ze,[Ie,e(g,{variant:"soft",size:"xs",color:"blue"},{default:l(()=>[De]),_:1})])]),t("div",Pe,x(o.message),1),t("div",{class:X(["flex items-center",o.file_url?"justify-between":"justify-end"])},[o.file_url?(m(),$(c,{key:0,color:"green",variant:"soft",onClick:B=>k(o.file_url)},{default:l(()=>[e(i,{name:"i-heroicons-arrow-down-tray"}),h(" Attached File ")]),_:2},1032,["onClick"])):F("",!0),t("span",Re,x(z(new Date(o.time),{addSuffix:!0})),1)],2)]),_:2},1024)])):(m(),M("div",Te,[e(C,{ui:{body:{base:"w-full",padding:"p-4 sm:p-4"}},class:"flex gap-4 items-center w-full"},{default:l(()=>[t("div",Ae,[e(w,{alt:o.user.fullname,src:o.user.photo,size:"md",imgClass:"object-cover"},null,8,["alt","src"]),t("div",Be,[t("span",Le,x(o.user.fullname),1)])]),t("div",Ne,x(o.message),1),t("div",{class:X(["flex items-center",o.file_url?"justify-between":"justify-end"])},[o.file_url?(m(),$(c,{key:0,color:"green",variant:"soft",onClick:B=>k(o.file_url)},{default:l(()=>[e(i,{name:"i-heroicons-arrow-down-tray"}),h(" Attached File ")]),_:2},1032,["onClick"])):F("",!0),t("span",He,x(z(new Date(o.time))),1)],2)]),_:2},1024)]))]))),128))])]),e(C,{ui:{body:{base:"w-full",padding:"p-4 sm:p-2"}},class:"flex gap-4 items-center w-full"},{default:l(()=>[e(I,{modelValue:p.value.message,"onUpdate:modelValue":f[1]||(f[1]=o=>p.value.message=o),class:"w-full mb-2",placeholder:"Add Comment...",variant:"none"},null,8,["modelValue"]),t("div",qe,[e(r,{"is-display-file":!1,accept:"*","max-size":"6291456",onFileUploaded:R}),e(c,{color:"primary",onClick:f[2]||(f[2]=o=>A(p.value))},{default:l(()=>[e(i,{name:"i-heroicons-paper-airplane"}),h(" Send ")]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},We=""+new URL("meeting.Myzv2aiY.svg",import.meta.url).href,Ye={class:"flex justify-between items-center w-full border-b border-1 pb-4"},Je=t("h3",{class:"text-lg font-semibold w-full flex justify-center text-primary"}," Upload Result ",-1),Ge={class:"flex flex-col w-full h-full my-4"},Ke=t("span",{class:"font-semibold py-4"}," Work Result ",-1),Qe={class:"flex flex-col"},Xe={class:"flex gap-2 justify-center items-center p-4"},Ze={class:"flex justify-center gap-2"},et=t("span",{class:"font-semibold py-4"}," Setup a Meeting ",-1),tt={class:"flex flex-col items-center"},at=["src"],ot={class:"flex gap-2 justify-center items-center p-4 font-semibold text-lg"},lt={class:"flex justify-center gap-2"},st={class:"w-full flex justify-end"},nt={__name:"UploadResultSidebar",props:{isOpen:{type:Boolean,default:!1},data:{type:Object}},emits:["update:isOpen","hide","refresh"],setup(N,{emit:P}){const{updateMerchantOrder:D}=K();te(),ae();const j=Y(),d=N,S=P,y=_(d.isOpen);V(()=>d.isOpen,a=>{y.value=a,a||O()}),V(y,a=>{S("update:isOpen",a)});const O=()=>{y.value=!1,b.value=!1,v.value=!1,p.value={result_file_url:"",meet_url:""},S("hide")},p=_({result_file_url:"",meet_url:""}),b=_(!1),v=_(!1),U=_({title:"",message:"",callback:null}),z=a=>{p.value.result_file_url=a},R=(a,i,c,w,g)=>{U.value={title:a,content:i,confirmText:c,cancelText:w,callback:g},b.value=!0},k=a=>{window.open(a,"_blank")},T=a=>{navigator.clipboard.writeText(a),j.add({title:"Copied!",color:"green",icon:"i-heroicons-check-circle",description:"Meeting URL copied to clipboard!"})},A=a=>{T(a),k(a)};V(()=>d.data,a=>{a&&a.actions&&a.actions.meet_url&&(p.value.meet_url=a.actions.meet_url)},{immediate:!0,deep:!0});const u=a=>{const i={};for(const c in a)a[c]!==""&&a[c]!==null&&a[c]!==void 0&&(i[c]=a[c]);return i},f=async()=>{const a=d.data.actions.id;try{const{data:i}=await D(a,u({result_file_url:p.value.result_file_url,meet_url:p.value.meet_url}));j.add({title:"Success!",color:"green",icon:"i-heroicons-check-circle",description:"Order updated successfully!"}),O()}catch(i){console.error("Updating order failed:",i),j.add({title:"Failed!",color:"red",icon:"i-heroicons-x-circle",description:"Failed to update order!"})}};return(a,i)=>{const c=G,w=ie,g=W,C=J,I=le,r=Z,s=re;return m(),$(s,{modelValue:y.value,"onUpdate:modelValue":i[5]||(i[5]=o=>y.value=o),fullscreen:"","prevent-close":"",ui:{base:"!w-[600px] absolute top-0 right-0 h-screen bg-white dark:bg-gray-800 rounded-l-3xl",rounded:"rounded-l-3xl rounded-r-0"}},{default:l(()=>[e(g,{ui:{base:"h-full ",ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800",rounded:"rounded-l-3xl rounded-r-0",body:{base:"flex flex-col justify-between h-full",padding:"px-6 py-5 sm:p-10"},header:{padding:"px-6 py-5 sm:px-8"},footer:{padding:"px-6 py-4 sm:px-10"}}},{default:l(()=>[t("div",Ye,[t("button",{onClick:O},[e(c,{name:"back",class:"text-2xl text-primary dark:text-gray-300"})]),Je]),t("div",Ge,[Ke,!d.data.actions.result_file_url||v.value?(m(),$(g,{key:0,ui:{base:"w-full h-[200px] border-dashed border-2",body:{base:"w-full h-[200px] flex justify-center items-center"}},ref:"dropzone-file"},{default:l(()=>[e(w,{title:"Result",accept:"*",center:!0,"max-size":"6291456",onFileUploaded:z})]),_:1},512)):(m(),$(g,{key:1,ui:{base:"w-full h-[200px] ",body:{base:"w-full h-[200px] flex justify-center items-center"}},ref:"dropzone-file"},{default:l(()=>[t("div",Qe,[t("div",Xe,[e(c,{name:"file"}),h(" Your Past Result ")]),t("div",Ze,[e(C,{icon:"i-heroicons-arrow-up-tray",onClick:i[0]||(i[0]=o=>R("Hang On","Are you sure you want to reupload this result?","Re Upload","Cancel",()=>v.value=!0))},{default:l(()=>[h(" Reupload ")]),_:1}),e(C,{icon:"i-heroicons-arrow-down-tray",onClick:i[1]||(i[1]=o=>k(d.data.actions.result_file_url))},{default:l(()=>[h(" Download ")]),_:1})])])]),_:1},512)),et,e(g,{ui:{base:"w-full ",body:{base:"flex justify-center items-center"}},ref:"dropzone-file"},{default:l(()=>[t("div",tt,[t("img",{src:oe(We),width:"200px",alt:""},null,8,at),t("div",ot,[e(I,{name:"i-heroicons-video-camera"}),h(" Meeting Link ")]),t("div",lt,[e(r,{modelValue:p.value.meet_url,"onUpdate:modelValue":i[2]||(i[2]=o=>p.value.meet_url=o)},null,8,["modelValue"]),d.data.actions.meet_url?(m(),$(C,{key:0,color:"primary",onClick:i[3]||(i[3]=o=>A(p.value.meet_url))},{default:l(()=>[e(I,{name:"i-heroicons-video-camera"}),h(" Open ")]),_:1})):F("",!0)])])]),_:1},512)]),t("div",st,[e(C,{color:"primary",onClick:i[4]||(i[4]=o=>f())},{default:l(()=>[e(c,{name:"floppy"}),h(" Save ")]),_:1})])]),_:1}),e(ne,{isOpen:b.value,data:U.value},null,8,["isOpen","data"])]),_:1},8,["modelValue"])}}},it={class:"pt-0 p-6 flex flex-col gap-2"},rt={class:"flex gap-2"},ct={key:0,class:"flex flex-col gap-1 items-start capitalize"},ut={class:"text-primary"},dt={key:1,class:"text-gray-300"},pt={class:"text-primary"},mt={class:"text-primary"},_t={class:"flex gap-3 items-center"},ft={class:"flex flex-col"},vt={class:"font-semibold text-primary"},gt={class:"text-sm text-gray-600"},xt={key:1,class:"text-gray-300"},yt={class:"flex gap-1"},ht="Order List",At={__name:"orders",setup(N){const{getMyMerchantOrders:P}=K();Y();const D=_(!0),j=_(!1),d=_(!1),S=_(!1),y=_({title:"",message:"",callback:null});_([]);const O=_([]),p=_({label:"All",value:"all"}),b=_(null),v=_(""),U=_(1),z=_({page:1,totalPage:1,totalItems:0,itemsPerPage:10}),R=[{label:"All",value:"all",color:"gray"},{label:"Completed",value:"completed",color:"orange"},{label:"Paid",value:"paid",color:"blue"},{label:"Pending",value:"pending",color:"orange"},{label:"Waiting Payment",value:"waitingpaid",color:"orange"},{label:"Failed",value:"failed",color:"orange"}],k=async()=>{try{await P({page:U.value,per_page:z.value.itemsPerPage,order_status:p.value.value==="all"?"":p.value.value,search:v.value}).then(r=>{O.value=r.data.data.orders.data.map((s,o)=>({no:o+1,service:{id:s.service.id,name:s.merchant.type,type:s.service.type},client:{id:s.user.id,fullname:s.user.fullname,email:s.user.email},"order date":f(s.created_at,"dd MMM yyyy"),estimated:`${s.service.time_estimated} ${s.service.time_estimated_unit}`,languages:{language_source:s.language_source,language_destination:s.language_destination},price:s.price,comments:{total:a(s.comment_json)?s.comment_json.length:0,data:s.comment_json||[]},status:s.order_status,file:s.user_file_url,actions:{id:s.id,status:s.order_status,result_file_url:s.result_file_url,meet_url:s.meet_url}}))})}catch(r){console.error("Error fetching merchant orders:",r)}finally{D.value=!1}};V(U,k),V(p,()=>{k()},{deep:!0}),V(v,be(()=>{k()},300));const T=()=>{k(U.value,p.value.value,v.value)},A=r=>{window.open(r,"_blank")},u=r=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(r),f=r=>new Date(r).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}),a=r=>{try{return JSON.parse(r)}catch{return r}},i=r=>{b.value=r,console.log("Refreshed data:",b)},c=()=>{d.value=!1,S.value=!1,k()},w=(r,s,o,B,H)=>{y.value={title:r,content:s,confirmText:o,cancelText:B,callback:H},j.value=!0},g=r=>{b.value=r,d.value=!0},C=r=>{b.value=r,S.value=!0},I=r=>{switch(r){case"completed":return{color:"green",text:"Completed"};case"paid":return{color:"blue",text:"In Progress"};case"pending":return{color:"violet",text:"Pending"};case"waitingpaid":return{color:"orange",text:"Waiting"};case"failed":return{color:"red",text:"Failed"};default:return{color:"gray",text:"Unknown"}}};return ye(()=>{k()}),(r,s)=>{const o=_e,B=Z,H=W,Q=ee,ce=se,L=J,ue=G,E=ke,de=Ce,pe=we,me=he;return m(),M("div",null,[e(me,{name:"merchant"},{default:l(()=>[t("div",it,[e(H,{ui:{body:{base:"flex justify-between items-center w-full",background:"",padding:"p-2 sm:p-4"}}},{default:l(()=>[t("h6",{class:"font-semibold"},x(ht)),t("div",rt,[e(o,{options:R,modelValue:p.value,"onUpdate:modelValue":s[0]||(s[0]=n=>p.value=n),placeholder:"Pilih Status",by:"value","option-attribute":"label","search-attributes":["label"],onChange:T,class:"max-w-[180px]"},null,8,["modelValue"]),e(B,{icon:"i-heroicons-magnifying-glass-20-solid",size:"sm",color:"white",trailing:!1,placeholder:"Search Order",modelValue:v.value,"onUpdate:modelValue":s[1]||(s[1]=n=>v.value=n)},null,8,["modelValue"])])]),_:1}),e(H,{ui:{body:{base:"flex flex-col gap-4"}}},{default:l(()=>[e(de,{rows:O.value,loading:D.value,"loading-state":{icon:"i-heroicons-arrow-path-20-solid",label:"Loading..."},ui:{wrapper:"max-w-full relative overflow-x-auto",base:" table-fixed overflow-x-auto"}},{"service-data":l(({row:n})=>[n.service?(m(),M("div",ct,[t("span",ut,x(n.service.name)+" Service ",1),e(Q,{variant:"soft",color:"orange",class:"capitalize"},{default:l(()=>[h(x(n.service.type),1)]),_:2},1024)])):(m(),M("span",dt," Kosong "))]),"price-data":l(({row:n})=>[t("span",pt,x(u(n.price)),1)]),"languages-data":l(({row:n})=>[t("span",mt,x(n.languages.language_source.name)+" -> "+x(n.languages.language_destination.name),1)]),"client-data":l(({row:n})=>[t("div",_t,[e(ce,{src:n.client.photo,alt:n.client.fullname,size:"sm",variant:"rounded-full",imgClass:"object-cover"},null,8,["src","alt"]),t("div",ft,[t("span",vt,x(n.client.fullname),1),t("span",gt,x(n.client.email),1)])])]),"comments-data":l(({row:n})=>[e(L,{size:"sm",color:"blue",variant:"soft",trailing:!1,onClick:q=>g(n)},{default:l(()=>[h(x(n.comments.total)+" Comments ",1)]),_:2},1032,["onClick"])]),"status-data":l(({row:n})=>[e(Q,{size:"xs",label:I(n.status).text,color:I(n.status).color,variant:"subtle",class:"capitalize"},null,8,["label","color"])]),"file-data":l(({row:n})=>[n.file?(m(),$(L,{key:0,size:"sm",color:"primary",trailing:!1,onClick:q=>A(n.file)},{default:l(()=>[e(ue,{name:"file",class:"text-white"}),h(" Open Client File ")]),_:2},1032,["onClick"])):(m(),M("span",xt," No File Uploaded "))]),"actions-data":l(({row:n})=>[t("div",yt,[n.actions.status==="pending"?(m(),$(E,{key:0,text:"Accept Order"},{default:l(()=>[e(L,{icon:"i-heroicons-check",size:"2xs",color:"green",variant:"outline",ui:{rounded:"rounded-full"},square:"",onClick:q=>w("Hang On","Are you sure you want to accept this order?","Accept Order","Cancel",()=>{r.updateUserStatus(n.user.id,"waitingpaid")})},null,8,["onClick"])]),_:2},1024)):F("",!0),n.actions.status==="paid"?(m(),$(E,{key:1,text:"Upload Works"},{default:l(()=>[e(L,{icon:"i-heroicons-arrow-up-tray",size:"2xs",color:"green",variant:"outline",ui:{rounded:"rounded-full"},square:"",onClick:q=>C(n)},null,8,["onClick"])]),_:2},1024)):F("",!0),n.actions.status==="completed"?(m(),$(E,{key:2,text:"Check Result"},{default:l(()=>[e(L,{icon:"i-heroicons-arrow-top-right-on-square",size:"2xs",color:"blue",variant:"outline",ui:{rounded:"rounded-full"},square:"",onClick:q=>C(n)},null,8,["onClick"])]),_:2},1024)):F("",!0)])]),_:1},8,["rows","loading"]),e(pe,{modelValue:U.value,"onUpdate:modelValue":s[2]||(s[2]=n=>U.value=n),"page-count":1,total:z.value.totalPage},null,8,["modelValue","total"])]),_:1})])]),_:1}),e(ne,{isOpen:j.value,data:y.value},null,8,["isOpen","data"]),e(Ee,{isOpen:d.value,data:b.value,onHide:c,onRefresh:i},null,8,["isOpen","data"]),e(nt,{isOpen:S.value,data:b.value,onHide:c,onRefresh:i},null,8,["isOpen","data"])])}}};export{At as default};
