import{_ as de}from"./C06A7VdL.js";import{_ as X}from"./x7ZR_v7-.js";import{_ as W}from"./Bhi3NMVq.js";import{_ as pe}from"./DuoJ_s3g.js";import{H as Z,G as ee,g as J,r as d,I as me,O as _e,h as F,o as p,m as M,w as l,b as e,a as n,c as V,n as z,d as w,x as fe,j as te,F as ge,E as ae,s as Y,i as ve,k as xe,t as j,q as ye,y as he}from"./DMHnhahR.js";import{_ as G}from"./BxGqzEK9.js";import{_ as be,a as ke}from"./D-zpJ1qe.js";import{_ as we}from"./DlNgySkh.js";import{_ as oe}from"./TBmgdKW5.js";import{_ as Ce}from"./C9zxKbhW.js";import{_ as le}from"./Bll3V974.js";import{_ as ne}from"./Du9OHuga.js";import{u as K}from"./scRL-lbJ.js";import"./DyU4X0IT.js";import"./A9DjunIi.js";import"./BoWCG-Uk.js";import"./WJtGFIw5.js";import"./CpkR63Mp.js";const Oe={class:"flex justify-between items-center w-full border-b border-1 pb-4"},Ue=n("h3",{class:"text-lg font-semibold w-full flex justify-center text-primary"}," Discussions ",-1),$e={class:"flex flex-col items-center justify-between w-full h-full"},Me={key:0,class:"py-4 text-gray-400"},Se={id:"comment-section",class:"w-full h-full max-h-[550px] overflow-auto px-2 py-1"},je={key:0,class:"pb-4"},Ve={key:1,class:"pb-4"},Fe={class:"flex justify-end border-t border-1 pt-2 gap-2"},Ie={__name:"CommentSidebar",props:{isOpen:{type:Boolean,default:!1},data:{type:Object,default:()=>({id:0,price:0,comments:{data:[],total:0},callback:()=>{}})}},emits:["update:isOpen","hide","refresh"],setup(N,{emit:D}){const{updateMerchantOrder:P}=K();Z(),ee();const C=J(),r=N,O=D,v=d(3),h=me("token").value.user,c=d({user:{fullname:h.fullname,photo:h.photo},message:"",time:new Date().toISOString(),file_url:"",other_link:"",is_facilitator:!0}),y=_e(()=>r.data.comments.data.slice(0,v.value)),f=d(r.isOpen);F(()=>r.isOpen,u=>{f.value=u,u||b()}),F(f,u=>{O("update:isOpen",u)});const b=()=>{f.value=!1,O("hide")},R=u=>{c.value.file_url=u},L=u=>{r.data.comments.data=u,O("refresh",r.data)},k=async u=>{const g=r.data.actions.id,U=r.data.comments.data??[];if(!u.message&&u.file_url&&(u.message="Here I attached a file."),!u.message&&!u.file_url){C.add({title:"Failed!",color:"red",icon:"i-heroicons-x-circle",description:"Comment message is required!"});return}U.push(u);try{const{data:S}=await P(g,{comment_json:U});C.add({title:"Success!",color:"green",icon:"i-heroicons-check-circle",description:"Order updated successfully!"}),L(U),v.value=U.length,setTimeout(()=>{const t=document.getElementById("comment-section");t.scrollTop=t.scrollHeight},2),c.value={user:{fullname:h.fullname,photo:h.photo},message:"",time:new Date().toISOString(),file_url:"",other_link:"",is_facilitator:!0}}catch(S){console.error("Updating order failed:",S),C.add({title:"Failed!",color:"red",icon:"i-heroicons-x-circle",description:"Failed to update order!"})}};return(u,g)=>{const U=G,S=ae,t=Y,s=W,m=Ce,I=le,$=ne;return p(),M($,{modelValue:f.value,"onUpdate:modelValue":g[3]||(g[3]=_=>f.value=_),fullscreen:"","prevent-close":"",ui:{base:"!w-full sm:!w-[600px] absolute top-0 right-0 h-screen bg-white dark:bg-gray-800 rounded-l-3xl",rounded:"rounded-l-3xl rounded-r-0"}},{default:l(()=>[e(s,{ui:{base:"h-full",ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800",rounded:"rounded-l-3xl rounded-r-0",body:{base:"flex flex-col justify-between h-full",padding:"px-6 py-5 sm:p-10"},header:{padding:"px-6 py-5 sm:px-8"},footer:{padding:"px-6 py-4 sm:px-10"}}},{default:l(()=>[n("div",Oe,[n("button",{onClick:b},[e(U,{name:"back",class:"text-2xl text-primary dark:text-gray-300"})]),Ue]),n("div",$e,[r.data.comments.total===0?(p(),V("div",Me," Start Discussion ")):z("",!0),v.value<r.data.comments.total?(p(),M(t,{key:1,block:"",color:"primary",variant:"soft",class:"my-4 bg-blue-100 hover:bg-blue-200",onClick:g[0]||(g[0]=_=>v.value=r.data.comments.total)},{default:l(()=>[e(S,{name:"i-heroicons-chat-bubble-oval-left-ellipsis"}),w(" Load Previous Comments ")]),_:1})):z("",!0),n("div",Se,[(p(!0),V(ge,null,fe(te(y),_=>(p(),V("div",{key:_,class:"w-full"},[_.is_facilitator?(p(),V("div",je,[e(s,{ui:{body:{base:"w-full",padding:"p-4 sm:p-4"}},class:"flex gap-4 items-center w-ful bg-gray-100"})])):(p(),V("div",Ve,[e(s,{ui:{body:{base:"w-full",padding:"p-4 sm:p-4"}},class:"flex gap-4 items-center w-full"})]))]))),128))])]),e(s,{ui:{body:{base:"w-full",padding:"p-4 sm:p-2"}},class:"flex gap-4 items-center w-full"},{default:l(()=>[e(m,{modelValue:c.value.message,"onUpdate:modelValue":g[1]||(g[1]=_=>c.value.message=_),class:"w-full mb-2",placeholder:"Add Comment...",variant:"none"},null,8,["modelValue"]),n("div",Fe,[e(I,{"is-display-file":!1,accept:"*","max-size":"6291456",onFileUploaded:R}),e(t,{color:"primary",onClick:g[2]||(g[2]=_=>k(c.value))},{default:l(()=>[e(S,{name:"i-heroicons-paper-airplane"}),w(" Send ")]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},Pe=""+new URL("meeting.Myzv2aiY.svg",import.meta.url).href,Re={class:"flex justify-between items-center w-full border-b border-1 pb-4"},ze=n("h3",{class:"text-lg font-semibold w-full flex justify-center text-primary"}," Upload Result ",-1),De={class:"flex flex-col w-full h-full my-4"},Le=n("span",{class:"font-semibold py-4"}," Work Result ",-1),Te={class:"flex flex-col"},Be={class:"flex gap-2 justify-center items-center p-4"},Ne={class:"flex justify-center gap-2"},Ae=n("span",{class:"font-semibold py-4"}," Setup a Meeting ",-1),He={class:"flex flex-col items-center"},qe=["src"],Ee={class:"flex gap-2 justify-center items-center p-4 font-semibold text-lg"},We={class:"flex justify-center gap-2"},Je={class:"w-full flex justify-end"},Ye={__name:"UploadResultSidebar",props:{isOpen:{type:Boolean,default:!1},data:{type:Object}},emits:["update:isOpen","hide","refresh"],setup(N,{emit:D}){const{updateMerchantOrder:P}=K();Z(),ee();const C=J(),r=N,O=D,v=d(r.isOpen);F(()=>r.isOpen,t=>{v.value=t,t||h()}),F(v,t=>{O("update:isOpen",t)});const h=()=>{v.value=!1,y.value=!1,f.value=!1,c.value={result_file_url:"",meet_url:""},O("hide")},c=d({result_file_url:"",meet_url:""}),y=d(!1),f=d(!1),b=d({title:"",message:"",callback:null}),R=t=>{c.value.result_file_url=t},L=(t,s,m,I,$)=>{b.value={title:t,content:s,confirmText:m,cancelText:I,callback:$},y.value=!0},k=t=>{window.open(t,"_blank")},u=t=>{navigator.clipboard.writeText(t),C.add({title:"Copied!",color:"green",icon:"i-heroicons-check-circle",description:"Meeting URL copied to clipboard!"})},g=t=>{u(t),k(t)};F(()=>r.data,t=>{t&&t.actions&&t.actions.meet_url&&(c.value.meet_url=t.actions.meet_url)},{immediate:!0,deep:!0});const U=t=>{const s={};for(const m in t)t[m]!==""&&t[m]!==null&&t[m]!==void 0&&(s[m]=t[m]);return s},S=async()=>{const t=r.data.actions.id;try{const{data:s}=await P(t,U({result_file_url:c.value.result_file_url,meet_url:c.value.meet_url}));C.add({title:"Success!",color:"green",icon:"i-heroicons-check-circle",description:"Order updated successfully!"}),h()}catch(s){console.error("Updating order failed:",s),C.add({title:"Failed!",color:"red",icon:"i-heroicons-x-circle",description:"Failed to update order!"})}};return(t,s)=>{const m=G,I=le,$=W,_=Y,T=ae,i=X,o=ne;return p(),M(o,{modelValue:v.value,"onUpdate:modelValue":s[5]||(s[5]=x=>v.value=x),fullscreen:"","prevent-close":"",ui:{base:"!w-[600px] absolute top-0 right-0 h-screen bg-white dark:bg-gray-800 rounded-l-3xl",rounded:"rounded-l-3xl rounded-r-0"}},{default:l(()=>[e($,{ui:{base:"h-full ",ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800",rounded:"rounded-l-3xl rounded-r-0",body:{base:"flex flex-col justify-between h-full",padding:"px-6 py-5 sm:p-10"},header:{padding:"px-6 py-5 sm:px-8"},footer:{padding:"px-6 py-4 sm:px-10"}}},{default:l(()=>[n("div",Re,[n("button",{onClick:h},[e(m,{name:"back",class:"text-2xl text-primary dark:text-gray-300"})]),ze]),n("div",De,[Le,!r.data.actions.result_file_url||f.value?(p(),M($,{key:0,ui:{base:"w-full h-[200px] border-dashed border-2",body:{base:"w-full h-[200px] flex justify-center items-center"}},ref:"dropzone-file"},{default:l(()=>[e(I,{title:"Result",accept:"*",center:!0,"max-size":"6291456",onFileUploaded:R})]),_:1},512)):(p(),M($,{key:1,ui:{base:"w-full h-[200px] ",body:{base:"w-full h-[200px] flex justify-center items-center"}},ref:"dropzone-file"},{default:l(()=>[n("div",Te,[n("div",Be,[e(m,{name:"file"}),w(" Your Past Result ")]),n("div",Ne,[e(_,{icon:"i-heroicons-arrow-up-tray",onClick:s[0]||(s[0]=x=>L("Hang On","Are you sure you want to reupload this result?","Re Upload","Cancel",()=>f.value=!0))},{default:l(()=>[w(" Reupload ")]),_:1}),e(_,{icon:"i-heroicons-arrow-down-tray",onClick:s[1]||(s[1]=x=>k(r.data.actions.result_file_url))},{default:l(()=>[w(" Download ")]),_:1})])])]),_:1},512)),Ae,e($,{ui:{base:"w-full ",body:{base:"flex justify-center items-center"}},ref:"dropzone-file"},{default:l(()=>[n("div",He,[n("img",{src:te(Pe),width:"200px",alt:""},null,8,qe),n("div",Ee,[e(T,{name:"i-heroicons-video-camera"}),w(" Meeting Link ")]),n("div",We,[e(i,{modelValue:c.value.meet_url,"onUpdate:modelValue":s[2]||(s[2]=x=>c.value.meet_url=x)},null,8,["modelValue"]),r.data.actions.meet_url?(p(),M(_,{key:0,color:"primary",onClick:s[3]||(s[3]=x=>g(c.value.meet_url))},{default:l(()=>[e(T,{name:"i-heroicons-video-camera"}),w(" Open ")]),_:1})):z("",!0)])])]),_:1},512)]),n("div",Je,[e(_,{color:"primary",onClick:s[4]||(s[4]=x=>S())},{default:l(()=>[e(m,{name:"floppy"}),w(" Save ")]),_:1})])]),_:1}),e(oe,{isOpen:y.value,data:b.value},null,8,["isOpen","data"])]),_:1},8,["modelValue"])}}},Ge={class:"pt-0 p-6 flex flex-col gap-2"},Ke={class:"flex gap-2"},Qe={key:0,class:"flex flex-col gap-1 items-start capitalize"},Xe={class:"text-primary"},Ze={key:1,class:"text-gray-300"},et={class:"text-primary"},tt={class:"text-primary"},at={class:"flex gap-3 items-center"},ot={class:"flex flex-col"},lt={class:"font-semibold text-primary"},nt={class:"text-sm text-gray-600"},st={key:1,class:"text-gray-300"},it={class:"flex gap-1"},rt="Order List",$t={__name:"orders",setup(N){const{getMyMerchantOrders:D}=K();J();const P=d(!0),C=d(!1),r=d(!1),O=d(!1),v=d({title:"",message:"",callback:null});d([]);const h=d([]),c=d({label:"All",value:"all"}),y=d(null),f=d(""),b=d(1),R=d({page:1,totalPage:1,totalItems:0,itemsPerPage:10}),L=[{label:"All",value:"all",color:"gray"},{label:"Completed",value:"completed",color:"orange"},{label:"Paid",value:"paid",color:"blue"},{label:"Pending",value:"pending",color:"orange"},{label:"Waiting Payment",value:"waitingpaid",color:"orange"},{label:"Failed",value:"failed",color:"orange"}],k=async()=>{try{await D({page:b.value,per_page:R.value.itemsPerPage,order_status:c.value.value==="all"?"":c.value.value,search:f.value}).then(i=>{h.value=i.data.data.orders.data.map((o,x)=>({no:x+1,service:{id:o.service.id,name:o.merchant.type,type:o.service.type},client:{id:o.user.id,fullname:o.user.fullname,email:o.user.email},"order date":S(o.created_at,"dd MMM yyyy"),estimated:`${o.service.time_estimated} ${o.service.time_estimated_unit}`,languages:{language_source:o.language_source,language_destination:o.language_destination},price:o.price,comments:{total:t(o.comment_json)?o.comment_json.length:0,data:o.comment_json||[]},status:o.order_status,file:o.user_file_url,actions:{id:o.id,status:o.order_status,result_file_url:o.result_file_url,meet_url:o.meet_url}}))})}catch(i){console.error("Error fetching merchant orders:",i)}finally{P.value=!1}};F(b,k),F(c,()=>{k()},{deep:!0}),F(f,ye(()=>{k()},300));const u=()=>{k(b.value,c.value.value,f.value)},g=i=>{window.open(i,"_blank")},U=i=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(i),S=i=>new Date(i).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}),t=i=>{try{return JSON.parse(i)}catch{return i}},s=i=>{y.value=i,console.log("Refreshed data:",y)},m=()=>{r.value=!1,O.value=!1,k()},I=(i,o,x,q,A)=>{v.value={title:i,content:o,confirmText:x,cancelText:q,callback:A},C.value=!0},$=i=>{y.value=i,r.value=!0},_=i=>{y.value=i,O.value=!0},T=i=>{switch(i){case"completed":return{color:"green",text:"Completed"};case"paid":return{color:"blue",text:"In Progress"};case"pending":return{color:"violet",text:"Pending"};case"waitingpaid":return{color:"orange",text:"Waiting"};case"failed":return{color:"red",text:"Failed"};default:return{color:"gray",text:"Unknown"}}};return ve(()=>{k()}),(i,o)=>{const x=de,q=X,A=W,Q=pe,se=he,B=Y,ie=G,E=be,re=we,ce=ke,ue=xe;return p(),V("div",null,[e(ue,{name:"merchant"},{default:l(()=>[n("div",Ge,[e(A,{ui:{body:{base:"flex justify-between items-center w-full",background:"",padding:"p-2 sm:p-4"}}},{default:l(()=>[n("h6",{class:"font-semibold"},j(rt)),n("div",Ke,[e(x,{options:L,modelValue:c.value,"onUpdate:modelValue":o[0]||(o[0]=a=>c.value=a),placeholder:"Pilih Status",by:"value","option-attribute":"label","search-attributes":["label"],onChange:u,class:"max-w-[180px]"},null,8,["modelValue"]),e(q,{icon:"i-heroicons-magnifying-glass-20-solid",size:"sm",color:"white",trailing:!1,placeholder:"Search Order",modelValue:f.value,"onUpdate:modelValue":o[1]||(o[1]=a=>f.value=a)},null,8,["modelValue"])])]),_:1}),e(A,{ui:{body:{base:"flex flex-col gap-4"}}},{default:l(()=>[e(re,{rows:h.value,loading:P.value,"loading-state":{icon:"i-heroicons-arrow-path-20-solid",label:"Loading..."},ui:{wrapper:"max-w-full relative overflow-x-auto",base:" table-fixed overflow-x-auto"}},{"service-data":l(({row:a})=>[a.service?(p(),V("div",Qe,[n("span",Xe,j(a.service.name)+" Service ",1),e(Q,{variant:"soft",color:"orange",class:"capitalize"},{default:l(()=>[w(j(a.service.type),1)]),_:2},1024)])):(p(),V("span",Ze," Kosong "))]),"price-data":l(({row:a})=>[n("span",et,j(U(a.price)),1)]),"languages-data":l(({row:a})=>[n("span",tt,j(a.languages.language_source.name)+" -> "+j(a.languages.language_destination.name),1)]),"client-data":l(({row:a})=>[n("div",at,[e(se,{src:a.client.photo,alt:a.client.fullname,size:"sm",variant:"rounded-full",imgClass:"object-cover"},null,8,["src","alt"]),n("div",ot,[n("span",lt,j(a.client.fullname),1),n("span",nt,j(a.client.email),1)])])]),"comments-data":l(({row:a})=>[e(B,{size:"sm",color:"blue",variant:"soft",trailing:!1,onClick:H=>$(a)},{default:l(()=>[w(j(a.comments.total)+" Comments ",1)]),_:2},1032,["onClick"])]),"status-data":l(({row:a})=>[e(Q,{size:"xs",label:T(a.status).text,color:T(a.status).color,variant:"subtle",class:"capitalize"},null,8,["label","color"])]),"file-data":l(({row:a})=>[a.file?(p(),M(B,{key:0,size:"sm",color:"primary",trailing:!1,onClick:H=>g(a.file)},{default:l(()=>[e(ie,{name:"file",class:"text-white"}),w(" Open Client File ")]),_:2},1032,["onClick"])):(p(),V("span",st," No File Uploaded "))]),"actions-data":l(({row:a})=>[n("div",it,[a.actions.status==="pending"?(p(),M(E,{key:0,text:"Accept Order"},{default:l(()=>[e(B,{icon:"i-heroicons-check",size:"2xs",color:"green",variant:"outline",ui:{rounded:"rounded-full"},square:"",onClick:H=>I("Hang On","Are you sure you want to accept this order?","Accept Order","Cancel",()=>{i.updateUserStatus(a.user.id,"waitingpaid")})},null,8,["onClick"])]),_:2},1024)):z("",!0),a.actions.status==="paid"?(p(),M(E,{key:1,text:"Upload Works"},{default:l(()=>[e(B,{icon:"i-heroicons-arrow-up-tray",size:"2xs",color:"green",variant:"outline",ui:{rounded:"rounded-full"},square:"",onClick:H=>_(a)},null,8,["onClick"])]),_:2},1024)):z("",!0),a.actions.status==="completed"?(p(),M(E,{key:2,text:"Check Result"},{default:l(()=>[e(B,{icon:"i-heroicons-arrow-top-right-on-square",size:"2xs",color:"blue",variant:"outline",ui:{rounded:"rounded-full"},square:"",onClick:H=>_(a)},null,8,["onClick"])]),_:2},1024)):z("",!0)])]),_:1},8,["rows","loading"]),e(ce,{modelValue:b.value,"onUpdate:modelValue":o[2]||(o[2]=a=>b.value=a),"page-count":1,total:R.value.totalPage},null,8,["modelValue","total"])]),_:1})])]),_:1}),e(oe,{isOpen:C.value,data:v.value},null,8,["isOpen","data"]),e(Ie,{isOpen:r.value,data:y.value,onHide:m,onRefresh:s},null,8,["isOpen","data"]),e(Ye,{isOpen:O.value,data:y.value,onHide:m,onRefresh:s},null,8,["isOpen","data"])])}}};export{$t as default};
